[{"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 223162, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4237, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 493137, "username": "3country", "url": "https://www.v2ex.com/u/3country", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/2f05/c870/493137_mini.png?m=1711607894", "avatar_normal": "https://cdn.v2ex.com/avatar/2f05/c870/493137_normal.png?m=1711607894", "avatar_large": "https://cdn.v2ex.com/avatar/2f05/c870/493137_large.png?m=1711607894", "created": 1591253138, "last_modified": 1711607894}, "last_reply_by": "cue", "last_touched": 1726678745, "title": "已经交了 2W 定金，要不要放弃买房？", "url": "https://www.v2ex.com/t/1073623", "created": 1726627606, "deleted": 0, "content": "三线城市总房款 130w ，计划首付 40%，交了定金快三个月了，如果没有一些意外情况和开发商延期交付，或许我早已经背上房贷了，现在开发商即将勉强交付，催我交首付了，我陷入了纠结：买还是不买\r\n\r\n我的情况：本来在老家三线工作，现在因为公司提供了更好的机会来到了省会（不太想在这里定居），计划今年底跟女朋友订婚，买房子这个事其实也是为了女朋友和结婚用\r\n\r\n为什么纠结：\r\n1. 房子本身不够硬，因为缺钱，一直在减配，验房时很多业主反馈有漏水问题，收尾工作一地鸡毛，有房产证下不来的风险\r\n2. 现在的楼市一路下跌，买来自住已经亏了，如果要卖亏得会更多\r\n3. 如果现在放弃这个房子，2w 定金打水漂，估计明年还是需要买，看房还是很费精力的一件事\r\n4. 这个新房小区是当时看了两三个月后综合评估定下来的，除了位置我不喜欢，其他还好\r\n\r\n可能本质上我还是不想负债，更不想让自己几年白干，现在对未来充满恐慌了", "content_rendered": "<p>三线城市总房款 130w ，计划首付 40%，交了定金快三个月了，如果没有一些意外情况和开发商延期交付，或许我早已经背上房贷了，现在开发商即将勉强交付，催我交首付了，我陷入了纠结：买还是不买</p>\n<p>我的情况：本来在老家三线工作，现在因为公司提供了更好的机会来到了省会（不太想在这里定居），计划今年底跟女朋友订婚，买房子这个事其实也是为了女朋友和结婚用</p>\n<p>为什么纠结：</p>\n<ol>\n<li>房子本身不够硬，因为缺钱，一直在减配，验房时很多业主反馈有漏水问题，收尾工作一地鸡毛，有房产证下不来的风险</li>\n<li>现在的楼市一路下跌，买来自住已经亏了，如果要卖亏得会更多</li>\n<li>如果现在放弃这个房子，2w 定金打水漂，估计明年还是需要买，看房还是很费精力的一件事</li>\n<li>这个新房小区是当时看了两三个月后综合评估定下来的，除了位置我不喜欢，其他还好</li>\n</ol>\n<p>可能本质上我还是不想负债，更不想让自己几年白干，现在对未来充满恐慌了</p>\n", "last_modified": 1726627606, "replies": 170, "id": 1073623}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 223162, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4237, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 693918, "username": "apollo007", "url": "https://www.v2ex.com/u/apollo007", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/ed76/9435/693918_mini.png?m=1720359583", "avatar_normal": "https://cdn.v2ex.com/avatar/ed76/9435/693918_normal.png?m=1720359583", "avatar_large": "https://cdn.v2ex.com/avatar/ed76/9435/693918_large.png?m=1720359583", "avatar_xlarge": "https://cdn.v2ex.com/avatar/ed76/9435/693918_xlarge.png?m=1720359583", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/ed76/9435/693918_xlarge.png?m=1720359583", "avatar_xxxlarge": "https://cdn.v2ex.com/avatar/ed76/9435/693918_xlarge.png?m=1720359583", "created": 1717387944, "last_modified": 1720359583}, "last_reply_by": "huangwei1024", "last_touched": 1726667777, "title": "老是熬夜，有办法可以强制给手机断网吗？", "url": "https://www.v2ex.com/t/1073561", "created": 1726618444, "deleted": 0, "content": "最近老是熬夜，刷手机，熬到 2 点，早上必须要 7 点半醒来，把自己搞得很累，我想问问各位彦祖，有办法设置为到了晚上 11 点，就强制给手机断网之类的吗？既给手机断网，也给家里 WiFi 断网（家里路由器是 redmi AX6000 ）。", "content_rendered": "<p>最近老是熬夜，刷手机，熬到 2 点，早上必须要 7 点半醒来，把自己搞得很累，我想问问各位彦祖，有办法设置为到了晚上 11 点，就强制给手机断网之类的吗？既给手机断网，也给家里 WiFi 断网（家里路由器是 redmi AX6000 ）。</p>\n", "last_modified": 1726618444, "replies": 139, "id": 1073561}, {"node": {"avatar_large": "/static/img/node_default_large.png", "name": "fit", "avatar_normal": "/static/img/node_default_normal.png", "title": "健康", "url": "https://www.v2ex.com/go/fit", "topics": 1281, "footer": "", "header": "这个节点的设立，是为了让大家可以分享关于健身和健康生活方式的经验。如果你有什么正在困扰自己的身体症状，请立刻寻求正规医院的帮助。", "title_alternative": "Fit", "avatar_mini": "/static/img/node_default_mini.png", "stars": 352, "aliases": [], "root": false, "id": 700, "parent_node_name": "life"}, "member": {"id": 94113, "username": "suny0508", "url": "https://www.v2ex.com/u/suny0508", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/65f1b651bca8672a152f281e415f48dc?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/65f1b651bca8672a152f281e415f48dc?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/65f1b651bca8672a152f281e415f48dc?s=73&d=retro", "created": 1422348047, "last_modified": 1726626747}, "last_reply_by": "sirlr", "last_touched": 1726675323, "title": "腰椎间盘突出，几个月治疗无任何效果，请教各位老铁", "url": "https://www.v2ex.com/t/1073621", "created": 1726627550, "deleted": 0, "content": "各位老铁。\r\n\r\n五月份有天突然感觉大腿不舒服，不是很强烈，以为是打羽毛球肌肉酸痛，但是过了几天没有好转，前后持续了一周，就去医院看，医生推测是腰椎间盘突出，让我去拍核磁，拿到片子，果不其然，L4 ，5 突出，然后就是保守治疗，针灸，拔罐，到了六月份，感觉保守治疗没有任何效果(当时做完有点舒服，过个一两个小时该怎么痛还是怎么痛)，然后就感觉越来越严重，右侧臀部到大腿后侧持续疼痛，无任何缓解。开的药吃了也没任何效果了。\r\n\r\n先后在各大医院，成都骨科医院，华西，成都市第一人民医院，各个医生给的意见都是保守治疗，而且影像学来说，突出很轻微，甚至比我要突出更厉害的人都不会有疼痛感，没法我运气差，就突出的部位，髓核刚好压迫了坐骨神经，无法坐，坐立不安的疼痛，车也没法开，稍微走个十多分钟，就有明显不适感，只有躺着才舒服些。\r\n只有双氯芬酸钠肠溶片这种止疼药，能缓解疼痛，但是这种药伤胃，不能长期吃。\r\n\r\n期间还听医生建议去住了 10 天院，输液(止疼+消炎+轻微激素)，结果还是没有效果。\r\n\r\n差不多快 5 个月了，我已经死心了，生活对我来说都没啥意思了，我才三十多岁，后面的人生怎么办，求教各位老铁，有没有跟我类似的症状，和现象。能给我一点意见，让我能缓解一下疼痛，重拾对生活的信心。", "content_rendered": "各位老铁。<br /><br />五月份有天突然感觉大腿不舒服，不是很强烈，以为是打羽毛球肌肉酸痛，但是过了几天没有好转，前后持续了一周，就去医院看，医生推测是腰椎间盘突出，让我去拍核磁，拿到片子，果不其然，L4 ，5 突出，然后就是保守治疗，针灸，拔罐，到了六月份，感觉保守治疗没有任何效果(当时做完有点舒服，过个一两个小时该怎么痛还是怎么痛)，然后就感觉越来越严重，右侧臀部到大腿后侧持续疼痛，无任何缓解。开的药吃了也没任何效果了。<br /><br />先后在各大医院，成都骨科医院，华西，成都市第一人民医院，各个医生给的意见都是保守治疗，而且影像学来说，突出很轻微，甚至比我要突出更厉害的人都不会有疼痛感，没法我运气差，就突出的部位，髓核刚好压迫了坐骨神经，无法坐，坐立不安的疼痛，车也没法开，稍微走个十多分钟，就有明显不适感，只有躺着才舒服些。<br />只有双氯芬酸钠肠溶片这种止疼药，能缓解疼痛，但是这种药伤胃，不能长期吃。<br /><br />期间还听医生建议去住了 10 天院，输液(止疼+消炎+轻微激素)，结果还是没有效果。<br /><br />差不多快 5 个月了，我已经死心了，生活对我来说都没啥意思了，我才三十多岁，后面的人生怎么办，求教各位老铁，有没有跟我类似的症状，和现象。能给我一点意见，让我能缓解一下疼痛，重拾对生活的信心。", "last_modified": 1726627550, "replies": 135, "id": 1073621}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1700771269", "name": "programmer", "avatar_normal": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1700771269", "title": "程序员", "url": "https://www.v2ex.com/go/programmer", "topics": 64179, "footer": "", "header": "While code monkeys are not eating bananas, they're coding.", "title_alternative": "Programmer", "avatar_mini": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1700771269", "stars": 9082, "aliases": [], "root": false, "id": 300, "parent_node_name": "computer"}, "member": {"id": 499495, "username": "Ayanokouji", "url": "https://www.v2ex.com/u/Ayanokouji", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/a3330a6a823a9945c860c7aa2cb1c29f?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/a3330a6a823a9945c860c7aa2cb1c29f?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/a3330a6a823a9945c860c7aa2cb1c29f?s=73&d=retro", "created": 1594909971, "last_modified": 1710898957}, "last_reply_by": "WispZhan", "last_touched": 1726670625, "title": "JDK 23 发布了", "url": "https://www.v2ex.com/t/1073571", "created": 1726620754, "deleted": 0, "content": "此版本是非 lts 版本，主要特性是决定了 zgc 发展方向\r\n\r\n本帖不欢迎刷 jdk8 梗\r\n\r\nFeatures\r\n\r\n455:\tPrimitive Types in Patterns, instanceof, and switch (Preview)\r\n466:\tClass-File API (Second Preview)\r\n467:\tMarkdown Documentation Comments\r\n469:\tVector API (Eighth Incubator)\r\n473:\tStream Gatherers (Second Preview)\r\n471:\tDeprecate the Memory-Access Methods in sun.misc.Unsafe for Removal\r\n474:\tZGC: Generational Mode by Default\r\n476:\tModule Import Declarations (Preview)\r\n477:\tImplicitly Declared Classes and Instance Main Methods (Third Preview)\r\n480:\tStructured Concurrency (Third Preview)\r\n481:\tScoped Values (Third Preview)\r\n482:\tFlexible Constructor Bodies (Second Preview)\r\n\r\nhttps://openjdk.org/projects/jdk/23/", "content_rendered": "此版本是非 lts 版本，主要特性是决定了 zgc 发展方向<br /><br />本帖不欢迎刷 jdk8 梗<br /><br />Features<br /><br />455:\tPrimitive Types in Patterns, instanceof, and switch (Preview)<br />466:\tClass-File API (Second Preview)<br />467:\tMarkdown Documentation Comments<br />469:\tVector API (Eighth Incubator)<br />473:\tStream Gatherers (Second Preview)<br />471:\tDeprecate the Memory-Access Methods in sun.misc.Unsafe for Removal<br />474:\tZGC: Generational Mode by Default<br />476:\tModule Import Declarations (Preview)<br />477:\tImplicitly Declared Classes and Instance Main Methods (Third Preview)<br />480:\tStructured Concurrency (Third Preview)<br />481:\tScoped Values (Third Preview)<br />482:\tFlexible Constructor Bodies (Second Preview)<br /><br /><a target=\"_blank\" href=\"https://openjdk.org/projects/jdk/23/\" rel=\"nofollow noopener\">https://openjdk.org/projects/jdk/23/</a>", "last_modified": 1726620754, "replies": 101, "id": 1073571}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 223162, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4237, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 357200, "username": "yfixx", "url": "https://www.v2ex.com/u/yfixx", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/6138b0dbd40e3fc92a5321892282dd7a?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/6138b0dbd40e3fc92a5321892282dd7a?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/6138b0dbd40e3fc92a5321892282dd7a?s=73&d=retro", "created": 1539934775, "last_modified": 1725982016}, "last_reply_by": "Planarians", "last_touched": 1726674676, "title": "妹妹马上要结婚了给多少好？", "url": "https://www.v2ex.com/t/1073643", "created": 1726629500, "deleted": 0, "content": "妹妹马上要结婚了给多少好？目前失业状态", "content_rendered": "妹妹马上要结婚了给多少好？目前失业状态", "last_modified": 1726629500, "replies": 95, "id": 1073643}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/a3c6/5c29/108_large.png?m=1691642161", "name": "bb", "avatar_normal": "https://cdn.v2ex.com/navatar/a3c6/5c29/108_normal.png?m=1691642161", "title": "宽带症候群", "url": "https://www.v2ex.com/go/bb", "topics": 16200, "footer": "", "header": "网速很重要。比快更快。", "title_alternative": "Broadband Symptom Complex", "avatar_mini": "https://cdn.v2ex.com/navatar/a3c6/5c29/108_mini.png?m=1691642161", "stars": 7545, "aliases": [], "root": false, "id": 108, "parent_node_name": "geek"}, "member": {"id": 253264, "username": "mouyase", "url": "https://www.v2ex.com/u/mouyase", "website": "yojigen.tech", "twitter": "mouyase", "psn": "mouyase_hk", "github": "mouyase", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/557b/bb26/253264_mini.png?m=1726601143", "avatar_normal": "https://cdn.v2ex.com/avatar/557b/bb26/253264_normal.png?m=1726601143", "avatar_large": "https://cdn.v2ex.com/avatar/557b/bb26/253264_large.png?m=1726601143", "created": 1504863873, "last_modified": 1726601143}, "last_reply_by": "mouyase", "last_touched": 1726679007, "title": "只花不到 150 元，部署一套可能是最佳体验的家庭网络系统", "url": "https://www.v2ex.com/t/1073554", "created": 1726601191, "deleted": 0, "content": "原文地址: [https://yojigen.tech/30.html]( https://yojigen.tech/30.html \"https://yojigen.tech/30.html\")\r\n\r\n\r\n## 前言\r\n\r\n~~哪个男孩不想要一个可以自由驰骋互联网的网络呢？~~\r\n\r\n关于家中的互联网建设这一块，已经不知道有多少博主聊过，自己也是来来回回折腾了很多种方案。\r\n\r\n最近终于找到了我直到目前为止我认为可能是最完美的方案——PaoPaoDNS+PaoPaoGateWay 。然后就在自己家的软路由系统里部署了起来，目前也是稳定用了一个月感觉非常的舒适。\r\n\r\n但是我家里面用的是软路由+虚拟机的方案，本身全套机器下载价格要 400 元左右了，而且机器也是做了一点点硬改，没有改机能力的人恐怕用起来也会比较麻烦。\r\n\r\n于是我就在想，能不能用比较便宜的方案，和较低的功耗，用一些市面上常见的设备来实现这一套方案呢？\r\n\r\n## 最终预期的结果\r\n\r\n在尽可能保证正常网络不会受到影响的情况下，实现网内透明代理，以用于科学上网。\r\n\r\n附赠功能: 去广告，虚拟局域网组网等\r\n\r\n## 设备选择和采购\r\n\r\n于是经过我的思考，最后做出了如下的设备方案:\r\n\r\n - 一台硬路由，要可以刷入支持设置静态路由，静态 DHCP 的系统(OpenWRT 、爱快、ROS 等)\r\n - 一台可以部署 Docker 容器的机器，例如一台小型 ARM 主机(玩客云，x905 电视盒子等)\r\n - 一台低功耗 x86 小主机(最好支持 AES 硬解)\r\n\r\n以上设备各位读者可以根据自身的经济条件和现有的设备来决定如何选择，比如全放进虚拟机里之类。而我这次选择的设备是下面这几个。\r\n\r\n### 硬路由-JCG Q30 Pro: 59 元\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024090412211939_c4ca4238a0b92382.webp)]( https://yojigen.tech/wp-content/uploads/2024090412211939_c4ca4238a0b92382.webp)\r\n\r\n这个价格不算特别的大众，这是一台天线坏掉的机器，而我的家里面因为还有三个其他的无线路由器当做 AP 使用，所以我不需要无线网络功能。\r\n\r\n这台机器的芯片是联发科的 mt7981 ，内存是 256m(也有 512m 的版本)，性能较好，可以轻松跑满千兆。而且这款机器还是被 OpenWRT 和 immortalwrt 官方支持的型号，可以直接刷主线版的固件，这样也可以避免一些网上所谓的“大神”编译的固件中的各种坑。\r\n\r\n机器怎么刷机我这里就不说了，网上有一些现成的资料，在这里说会导致教程太过于复杂，而且也许你的设备也不需要刷机，对吧。\r\n\r\n其实我个人目前比较推荐的机器是爱快 IK-Q3000 ，不用刷机就能享受官方的爱快的系统固件，机身自己支持 AX3000 ，如果没有其他无线组网，一台机器就能解决大部分人家中的路由和 WiFI 了。现在这个机器京东售价 159 ，同样所谓 mt7981 芯片的机器，他也就比别的机器贵了 20-30 。30 块钱买个免刷机带售后的爱快系统我觉得还是挺香的。(不过不清楚这台机器有没有硬件转发，如果没有的话还是不要用了)\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024090412213128_c81e728d9d4c2f63.webp)]( https://yojigen.tech/wp-content/uploads/2024090412213128_c81e728d9d4c2f63.webp)\r\n\r\n### ARM 主机-玩客云: 28 元\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024090412214239_eccbc87e4b5ce2fe.webp)]( https://yojigen.tech/wp-content/uploads/2024090412214239_eccbc87e4b5ce2fe.webp)\r\n\r\n玩客云算是我们垃圾佬应该非常熟悉的一个东西了，他本身是一个拿来做 PCDN 的所谓的“挖矿”设备，后续随着 PCDN 的收益越来越低，运营商对 PCDN 的打击等等原因，现在网上有着大量的机器在流通。而且由于存世量多，玩的人也多，这机器在价格便宜的同时，机器的玩法也开发的比较全面，很多系统都能刷入进去。\r\n\r\n我们这里选择给它刷入 Armbian ，以用来部署 Docker 容器，刷机方法大家也可以参考网络资料。\r\n\r\n### X86 小主机-中兴 CT321G2: 本人购入 79 元，咸鱼现价 50 元\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024090412215356_a87ff679a2f3e71d.webp)]( https://yojigen.tech/wp-content/uploads/2024090412215356_a87ff679a2f3e71d.webp)\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024090412215911_e4da3b7fbbce2345.webp)]( https://yojigen.tech/wp-content/uploads/2024090412215911_e4da3b7fbbce2345.webp)\r\n\r\n这个小机器是之前无意中发现的，机身外壳的做工还不错，虽然是塑料但是很厚实。这个机器由于只有一个千兆网口，不好做软路由，且只有一个无法更换 4g 硬盘，所以对于垃圾佬来说，可玩性就有点差了，导致价格一直不高。但是这台机器的 CPU 是小主机里面不太常见的 AMD GX-218GL ，这块 CPU 性能和 J1900 差不太多，功耗也都是在 10w 左右，但是他有一个 J1900 没有的优势: 支持 AES 硬解。\r\n\r\n大家都知道 AES 硬解意味着什么，加上小尺寸，低功耗，所以这台机器非常适合拿来做我们的网关机。\r\n\r\n注意: 这个机器只有 VGA 输出，需要你准备支持 VGA 的显示器和线，或者转换线。\r\n\r\n## 系统搭建\r\n\r\n### 主网络\r\n\r\n首先要保证你的网络是正常的，你需要了解如何使用你的路由器正确的设置上网功能。\r\n我这里以最常见的网络地址作为演示，你可以根据你的需求来设置自己的网段。\r\n\r\n```\r\n路由器 IP: 192.168.1.1\r\nDHCP 范围: 192.168.1.101-192.168.1.200\r\n局域网段: 192.168.1.0/24\r\n子网掩码: 255.255.255.0\r\n网关机 IP: 192.168.1.2\r\nDocker 容器机 IP: 192.168.1.3\r\n```\r\n\r\n### 网关机\r\n\r\n首先要准备一下 PaoPaoGateWay 的系统镜像，由于是在物理机运行，所以需要全网卡驱动的支持。官方 Github 上的镜像是默认不带全网卡驱动的，需要我们用官方的 docker 来定制一下 ios 镜像。\r\n定制方式非常简单，随便找一台 x86 的装有 docker 的机器(官方容器不支持 arm)，运行下面两条命令，就能在当前目录获得一个具有全部网卡的 ios 镜像了。\r\n\r\n```shell\r\ndocker pull sliamb/ppgwiso:fullmod\r\ndocker run --rm -v .:/data sliamb/ppgwiso:fullmod\r\n```\r\n\r\n如果你不方便定制，也可以下载我定制好的镜像文件(记得解压)。\r\n\r\n[paopao-gateway-x86-64-custom-364b136.zip]( https://github.com/mouyase/PaoPaoGateWay/releases/download/20240812-9eb91d3/paopao-gateway-x86-64-custom-364b136.zip)\r\n\r\n准备一个写磁盘的工具，Rufus 、balenaEtcher 、UltraISO 之类的都可以，我这里使用 Rufus 。\r\n准备一个 U 盘，将镜像文件写入到 U 盘里。\r\n\r\n然后将 U 盘插入 x86 小主机，在 Bios 里设置为从 U 盘启动系统，通电自动启动系统，最后用网线将网口和路由器的 Lan 口进行连接。\r\n\r\n这样网关机这里就算设置完成了。\r\n\r\n**注:**\r\n\r\n - 如果有条件可以将网关机接上屏幕开机测试一下，看看能不能正常启动开机看到日志。\r\n - 系统测试稳定之后，可以尝试用 PE 将 ISO 镜像写入到系统内置磁盘里，这样就可以不插 U 盘启动了，不过这样后面更新会稍微麻烦点。\r\n\r\n### Docker 机\r\n\r\n首先搭建好 Docker 环境，这里根据不同的设备和系统会有不同的方法，请根据网络上的教程自行操作。\r\n\r\n创建目录 DNS ，并且在其中创建`docker-compose.yaml`文件，用于配置容器。\r\n\r\n`docker-compose.yaml`文件内容参考如下。\r\n\r\n```yaml\r\nservices:\r\n  paopaodns_china:\r\n    image: sliamb/paopaodns:latest\r\n    container_name: PaoPaoDNS-China\r\n    restart: always\r\n    volumes:\r\n      - ./PaoPaoDNS-China:/data\r\n    networks:\r\n      dns:\r\n        ipv4_address: 172.30.1.10 # IP 地址为 Docker 内网分配地址，用于内网访问\r\n    environment:\r\n      - TZ=Asia/Shanghai\r\n      - UPDATE=weekly\r\n      - DNS_SERVERNAME=PaoPaoDNS-China\r\n      - DNSPORT=53\r\n      - CNAUTO=no\r\n\r\n  paopaodns _global:\r\n    image: sliamb/paopaodns:latest\r\n    container_name: PaoPaoDNS-Global\r\n    restart: always\r\n    volumes:\r\n      - ./PaoPaoDNS-Global:/data\r\n    networks:\r\n      dns:\r\n        ipu4_address: 172.30.1.20 # IP 地址为 Docker 内网分配地址，用于内网访问\r\n    environment:\r\n      - TZ=Asia/Shanghai\r\n      - UPDATE=weekly\r\n      - DNS_SERVERNAME=PaoPaoDNS-Global\r\n      - DNSPORT=53\r\n      - CNAUTO=yes\r\n      - CNFALL=yes\r\n      - CN_TRACKER=yes\r\n      - USE_HOSTS=no\r\n      - IPU6=no\r\n      - SOCKS5=192.168.1.2:1080 # IP 地址为网关机的 IP 地址\r\n      - SERVER_IP=192.168.1.3 # IP 地址为本台宿主机的 IP 地址\r\n      - CUSTOM_FORWARD=192.168.1.2:53 # IP 地址为网关机的 IP 地址\r\n      - AUTO_FORWARD=yes\r\n      - AUTO_FORWARD_CHECK=yes\r\n      - USE_MARK_DATA=yes\r\n      - HTTP_FILE=yes\r\n    ports:\r\n      - \"5304:5304/udp\"\r\n      - \"5304:5304/tcp\"\r\n      - \"7889:7889/tcp\"\r\n\r\n  adguard_home:\r\n    image: adguard/adguardhome:latest\r\n    container_name: AdGuardHome\r\n    restart: always\r\n    depends_on:\r\n    - paopaodns_china\r\n    - paopaodns_global\r\n    volumes:\r\n    - ./AdGuardHome:/opt/adguardhome/work\r\n    - ./AdGuardHome:/opt/adguardhome/conf\r\n    networks:\r\n      dns:\r\n        ipv4_address: 172.30.1.2 # IP 地址为 Docker 内网分配地址，用于内网访问\r\n    environment:\r\n      - TZ=Asia/Shanghai\r\n    ports:\r\n      - \"53:53/udp\"\r\n      - \"53:53/tcp\"\r\n      - \"80:80/tcp\" # 如果不是使用 80 端口作为网页端口则需要添加对应的端口映射\r\n      - \"3000:3000/tcp\" # 安装成功后可以删除\r\n\r\nnetworks:\r\n  dns:\r\n    driver: bridge\r\n    ipam:\r\n      driver: default\r\n      config:\r\n        - subnet: 172.30.1.0/24\r\n          gateway: 172.30.1.1\r\n```\r\n\r\n解释一下这个配置文件。\r\n\r\n这个配置文件定义了三个容器。\r\n\r\n两个 PaoPaoDNS ，用来作为 AdguardHome 的上游 DNS ，其中一个容器没有做特殊的配置，仅当做本地递归 DNS 服务器使用。而另一台则添加了分流相关的设置，用于对需要出国的设备进行 DNS 分流处理。\r\n\r\nAdguardHome ，用于提供本地 DNS 服务，给不同的客户端配置不同的上游 DNS ，以及去广告(虽然是他的本职，但是这里反而成了附赠的功能了)。\r\n\r\n注: 爱快官方之前在论坛中提到，系统更新到 3.7.12 后，DHCP 设置将支持对不同的客户端配置不同的 DNS ，所以用爱快系统的可以根据需求不使用 AdguardHome 。\r\n\r\n接下来启动容器。\r\n\r\n```shell\r\ndocker compose up -d\r\n```\r\n容器正常启动后，则可以使用`本机 IP:3000`访问 AdguardHome 的安装页面了，设置一下用户名和密码，以及 WebUI 的端口(建议 80)即可。\r\n\r\n### 网络配置\r\n\r\n因为我文章里是使用的 OpenWRT 作为路由系统，所以这里也是用 OpenWRT 来演示。\r\n\r\n启动网关机和 Docker 容器机，让他们的信息出现在你的路由器里面。\r\n\r\n首先要固定一下 IP 。\r\n\r\n打开 网络→DHCP/DNS→静态地址分配，将网关机的 IP 固定为`192.168.1.2`，将 Docker 机的 IP 固定为`192.168.1.3`。\r\n\r\n然后将 DHCP 默认的 DNS 设置为`192.168.1.3`(如果需要输入两个地址就都填一样的)。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719020618_1bb59a5cf2f75a5e.webp)]( https://yojigen.tech/wp-content/uploads/2024091719020618_1bb59a5cf2f75a5e.webp)\r\n\r\n接下来要设置网内设备的 DNS 。\r\n\r\n打开 网络→接口→lan→DHCP 服务器→高级设置，在 DHCP 选项中添加。\r\n\r\n```code\r\n6,192.168.1.3\r\n```\r\n\r\n这个值就是你的 Docker 机的 IP 。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719050519_dcf9d4e16ce100ea.webp)]( https://yojigen.tech/wp-content/uploads/2024091719050519_dcf9d4e16ce100ea.webp)\r\n\r\n然后重启一下网关机和 Docker 机，让他们可以获取到新的 IP 和 DNS 。\r\n\r\n接下来网页打开 AdguardHome 的后台[http://192.168.1.3]( http://192.168.1.3 \"http://192.168.1.3\")，在 DNS 设置中，将上游 DNS 设置为`172.30.1.10`，并且关闭缓存。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719082383_16a1523166bd1ae9.webp)]( https://yojigen.tech/wp-content/uploads/2024091719082383_16a1523166bd1ae9.webp)\r\n\r\n这时我们可以试一下我们的 DNS 能否正常使用。\r\n\r\n```shell\r\nnslookup whoami.03k.org 192.168.1.3\r\n服务器:  Unknown\r\nAddress:  192.168.1.3\r\n\r\n非权威应答:\r\n名称:    whoami.03k.org\r\nAddress:  123.234.123.234 #连接权威 DNS 服务器的 IP=你的宽带 IP\r\n```\r\n\r\n返回的地址如果是你的公网 IP 网段，就说明递归 DNS 已经生效了。\r\n\r\n接下来是设置静态路由，我们回到 OpenWRT 的界面。\r\n\r\n打开 网络→路由→静态 IPv4 路由，添加一条新的静态路由，类型`unicast`，目标`11.0.0.0/8`，网关`192.168.1.2`。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719092071_6e583d6e5568ccf3.webp)]( https://yojigen.tech/wp-content/uploads/2024091719092071_6e583d6e5568ccf3.webp)\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719175972_96a852a85b5e3e8d.webp)]( https://yojigen.tech/wp-content/uploads/2024091719175972_96a852a85b5e3e8d.webp)\r\n\r\n最后要屏蔽掉对 FakeIP 的 NAT 。\r\n\r\n打开 网络→防火墙→通信规则，添加一条新的规则，源区域为`lan`，目标区域为`wan`，目标地址为`11.0.0.0/8`，操作为`丢弃`。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719135684_6f2f75e01f73364b.webp)]( https://yojigen.tech/wp-content/uploads/2024091719135684_6f2f75e01f73364b.webp)\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719135961_b1a793f2fdf259c6.webp)]( https://yojigen.tech/wp-content/uploads/2024091719135961_b1a793f2fdf259c6.webp)\r\n\r\n**注:**\r\n\r\n如果有使用一些纯靠 IP 访问的软件(例如网飞、Telegram)，还需要把他们的 IP 端也设置相同的静态路由和通信规则中，比较长这里我就不写了，有需求的可以自行添加。\r\n\r\n到这里网络路由相关内容设置完毕。\r\n\r\n### 网关配置\r\n\r\n网关配置文件在 Docker 机器的`DNS/PaoPaoDNS-Global`目录中的`ppgw.ini`。\r\n\r\n```ini\r\n#paopao-gateway\r\n\r\n# mode=socks5|ovpn|yaml|suburl|free\r\n# default: free\r\n# free: 直接出站不走代理\r\n# socks5: 使用 socks5 代理出站\r\n# ovpn: 使用 ovpn 代理出站\r\n# yaml: 使用 yaml 配置文件，yaml 配置文件在同目录下，文件名参考下面的 yamlfile\r\n# suburl: 使用订阅地址，最常见的应该就是这种了\r\nmode=suburl\r\n\r\n# Set fakeip's CIDR here\r\n# default: fake_cidr=7.0.0.0/8\r\n# FakeIP 的网段，如果要修改，请修改成看似是外网的空 IP 网段\r\nfake_cidr=11.0.0.0/8\r\n\r\n# Set your trusted DNS here\r\n# default: dns_ip=1.0.0.1\r\n# 这里需要和 Docker 机，也就是 DNS 的 IP 匹配\r\ndns_ip=192.168.1.3\r\n# default: dns_port=53\r\n# If used with PaoPaoDNS, you can set the 5304 port\r\n# 这是网关获取配置的端口，如果没有修改过端口映射，请使用默认值\r\ndns_port=5304\r\n\r\n# Clash's web dashboard\r\n# 这是网页管理面板的端口和密码\r\nclash_web_port=\"80\"\r\nclash_web_password=\"clashpass\"\r\n\r\n# default：openport=no\r\n# socks+http mixed 1080\r\nopenport=no\r\n\r\n# default: udp_enable=no\r\nudp_enable=no\r\n\r\n# default:30\r\nsleeptime=30\r\n\r\n# socks5 mode settting\r\n# default: socks5_ip=gatewayIP\r\n# 这里需要填入网关 IP ，用于开启局域网内的 socks5 代理\r\nsocks5_ip=\"192.168.1.2\"\r\n# default: socks5_port=\"7890\"\r\nsocks5_port=\"7890\"\r\n\r\n# ovpn mode settting\r\n# The ovpn file in the same directory as the ppgw.ini.\r\n# default: ovpnfile=custom.ovpn\r\novpnfile=\"custom.ovpn\"\r\novpn_username=\"\"\r\novpn_password=\"\"\r\n\r\n# yaml mode settting\r\n# The yaml file in the same directory as the ppgw.ini.\r\n# default: yamlfile=custom.yaml\r\n# 这里是 yaml 模式时，网关获取的配置文件的文件名\r\nyamlfile=\"custom.yaml\"\r\n\r\n# suburl mode settting\r\n# 这里填入你的订阅地址\r\nsuburl=\"https://...\"\r\n# 这里是订阅自动更新时间\r\nsubtime=1d\r\n\r\n# fast_node=check/yes/no\r\n# check: 代表会自动检查下面的 URL 能否访问，如果不能访问则自动重启服务并重新拉取订阅\r\n# yes: 代表会自动根据延迟切换到延迟最低的节点，同时具有 check 的功能\r\n# no: 代表不检查延迟与连通性\r\nfast_node=yes\r\ntest_node_url=\"https://www.youtube.com/generate_204\"\r\next_node=\"Traffic|Expire| GB|Days|Date\"\r\ncpudelay=\"3000\"\r\n\r\n# dns burn setting\r\n# depend on fast_node=yes & mode=suburl/yaml\r\ndns_burn=no\r\n# If used with PaoPaoDNS, you can set the PaoPaoDNS:53\r\n# 这里需要设置成 DNS 的 IP\r\nex_dns=\"192.168.1.3:53\"\r\n\r\n# Network traffic records\r\nnet_rec=no\r\nmax_rec=5000\r\n```\r\n\r\n更详细的参数解释，以及自定义规则等等，请参考[官方的文档]( https://github.com/kkkgo/PaoPaoGateWay#ppgwini%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E)，如果没有特殊需求，按本文的配置即可。\r\n\r\n### 配置设备 DNS\r\n\r\n我的教程中的方案，是建立在网内只有一部分设备出国，另一部分正常用网的场景，所以需要针对不同的设备，设置不同的上游 DNS 服务器。\r\n\r\n如果你没有这种需求，可以直接在网络配置那一步中，将上游 DNS 设置为`172.30.1.20`，就不用继续往下看了。\r\n\r\n如果你也像我一样，只需要部分的设备走出国规则，那就还需要在多一步设置。\r\n\r\n打开 AdguardHome 的后台[http://192.168.1.3]( http://192.168.1.3 \"http://192.168.1.3\")。\r\n\r\n打开客户端设置，添加客户端。\r\n\r\n添加需要出国的设备的 IP 或者 IP 段，然后在下面的自定义上游的地方，将上游 DNS 设置为`172.30.1.20`，然后保存即可。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719181210_2f4c713455403fc7.webp)]( https://yojigen.tech/wp-content/uploads/2024091719181210_2f4c713455403fc7.webp)\r\n\r\n至此系统全部搭建完毕。\r\n\r\n## 测试\r\n\r\n可以使用 Speedtest ，分别选择国内和国外的测速节点，看一下带宽能否跑满。\r\n\r\n可以在[https://ip111.cn]( https://ip111.cn \"https://ip111.cn\")或者[https://ip.skk.moe]( https://ip.skk.moe \"https://ip.skk.moe\")检查一下 IP 分流是否正常。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719210259_aac670543d7d5533.webp)]( https://yojigen.tech/wp-content/uploads/2024091719210259_aac670543d7d5533.webp)\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719210965_2772b3be94a07bb8.webp)]( https://yojigen.tech/wp-content/uploads/2024091719210965_2772b3be94a07bb8.webp)\r\n\r\n可以用 NatTypeTester 检查一下 Nat 等级。\r\n\r\n[![]( https://yojigen.tech/wp-content/uploads/2024091719214622_af3abad9fd9dabd4.webp)]( https://yojigen.tech/wp-content/uploads/2024091719214622_af3abad9fd9dabd4.webp)\r\n\r\n## 总结\r\n\r\n整套设备花费是 59+28+50=137 元，这里是没有计算 U 盘和交换机的价格。\r\n\r\nU 盘作为一个搞机佬，我相信各位家里一定会有的，而交换机要看自己网内具体有多少需要网线的设备，所以我就没有算在内。\r\n\r\n这里面路由器的价格可能会有一些上下波动，比如你需要一款可以跑满千兆的路由器，又不想刷机，所以可能买了我推荐的爱快 Q3000 ，那价格就一下多了 100 元了，但是你买了更好的路由器就算不玩这套系统，那也可以让网络体验变好，也是不亏。而如果你家的网络没有达到千兆，比如只有 500M 甚至 100M ，那你大可买一些 mt7621 的路由器，刷个 OP 或者爱快的固件，这种路由器咸鱼 50 以内可以随便买。\r\n\r\n希望这篇文章可以帮助到一直想要一套舒适的网络的你。", "content_rendered": "<p>原文地址: <a href=\"https://yojigen.tech/30.html\" rel=\"nofollow\" title=\"https://yojigen.tech/30.html\">https://yojigen.tech/30.html</a></p>\n<h2>前言</h2>\n<p><del>哪个男孩不想要一个可以自由驰骋互联网的网络呢？</del></p>\n<p>关于家中的互联网建设这一块，已经不知道有多少博主聊过，自己也是来来回回折腾了很多种方案。</p>\n<p>最近终于找到了我直到目前为止我认为可能是最完美的方案——PaoPaoDNS+PaoPaoGateWay 。然后就在自己家的软路由系统里部署了起来，目前也是稳定用了一个月感觉非常的舒适。</p>\n<p>但是我家里面用的是软路由+虚拟机的方案，本身全套机器下载价格要 400 元左右了，而且机器也是做了一点点硬改，没有改机能力的人恐怕用起来也会比较麻烦。</p>\n<p>于是我就在想，能不能用比较便宜的方案，和较低的功耗，用一些市面上常见的设备来实现这一套方案呢？</p>\n<h2>最终预期的结果</h2>\n<p>在尽可能保证正常网络不会受到影响的情况下，实现网内透明代理，以用于科学上网。</p>\n<p>附赠功能: 去广告，虚拟局域网组网等</p>\n<h2>设备选择和采购</h2>\n<p>于是经过我的思考，最后做出了如下的设备方案:</p>\n<ul>\n<li>一台硬路由，要可以刷入支持设置静态路由，静态 DHCP 的系统(OpenWRT 、爱快、ROS 等)</li>\n<li>一台可以部署 Docker 容器的机器，例如一台小型 ARM 主机(玩客云，x905 电视盒子等)</li>\n<li>一台低功耗 x86 小主机(最好支持 AES 硬解)</li>\n</ul>\n<p>以上设备各位读者可以根据自身的经济条件和现有的设备来决定如何选择，比如全放进虚拟机里之类。而我这次选择的设备是下面这几个。</p>\n<h3>硬路由-JCG Q30 Pro: 59 元</h3>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024090412211939_c4ca4238a0b92382.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024090412211939_c4ca4238a0b92382.webp\"/></a></p>\n<p>这个价格不算特别的大众，这是一台天线坏掉的机器，而我的家里面因为还有三个其他的无线路由器当做 AP 使用，所以我不需要无线网络功能。</p>\n<p>这台机器的芯片是联发科的 mt7981 ，内存是 256m(也有 512m 的版本)，性能较好，可以轻松跑满千兆。而且这款机器还是被 OpenWRT 和 immortalwrt 官方支持的型号，可以直接刷主线版的固件，这样也可以避免一些网上所谓的“大神”编译的固件中的各种坑。</p>\n<p>机器怎么刷机我这里就不说了，网上有一些现成的资料，在这里说会导致教程太过于复杂，而且也许你的设备也不需要刷机，对吧。</p>\n<p>其实我个人目前比较推荐的机器是爱快 IK-Q3000 ，不用刷机就能享受官方的爱快的系统固件，机身自己支持 AX3000 ，如果没有其他无线组网，一台机器就能解决大部分人家中的路由和 WiFI 了。现在这个机器京东售价 159 ，同样所谓 mt7981 芯片的机器，他也就比别的机器贵了 20-30 。30 块钱买个免刷机带售后的爱快系统我觉得还是挺香的。(不过不清楚这台机器有没有硬件转发，如果没有的话还是不要用了)</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024090412213128_c81e728d9d4c2f63.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024090412213128_c81e728d9d4c2f63.webp\"/></a></p>\n<h3>ARM 主机-玩客云: 28 元</h3>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024090412214239_eccbc87e4b5ce2fe.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024090412214239_eccbc87e4b5ce2fe.webp\"/></a></p>\n<p>玩客云算是我们垃圾佬应该非常熟悉的一个东西了，他本身是一个拿来做 PCDN 的所谓的“挖矿”设备，后续随着 PCDN 的收益越来越低，运营商对 PCDN 的打击等等原因，现在网上有着大量的机器在流通。而且由于存世量多，玩的人也多，这机器在价格便宜的同时，机器的玩法也开发的比较全面，很多系统都能刷入进去。</p>\n<p>我们这里选择给它刷入 Armbian ，以用来部署 Docker 容器，刷机方法大家也可以参考网络资料。</p>\n<h3>X86 小主机-中兴 CT321G2: 本人购入 79 元，咸鱼现价 50 元</h3>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024090412215356_a87ff679a2f3e71d.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024090412215356_a87ff679a2f3e71d.webp\"/></a></p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024090412215911_e4da3b7fbbce2345.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024090412215911_e4da3b7fbbce2345.webp\"/></a></p>\n<p>这个小机器是之前无意中发现的，机身外壳的做工还不错，虽然是塑料但是很厚实。这个机器由于只有一个千兆网口，不好做软路由，且只有一个无法更换 4g 硬盘，所以对于垃圾佬来说，可玩性就有点差了，导致价格一直不高。但是这台机器的 CPU 是小主机里面不太常见的 AMD GX-218GL ，这块 CPU 性能和 J1900 差不太多，功耗也都是在 10w 左右，但是他有一个 J1900 没有的优势: 支持 AES 硬解。</p>\n<p>大家都知道 AES 硬解意味着什么，加上小尺寸，低功耗，所以这台机器非常适合拿来做我们的网关机。</p>\n<p>注意: 这个机器只有 VGA 输出，需要你准备支持 VGA 的显示器和线，或者转换线。</p>\n<h2>系统搭建</h2>\n<h3>主网络</h3>\n<p>首先要保证你的网络是正常的，你需要了解如何使用你的路由器正确的设置上网功能。\n我这里以最常见的网络地址作为演示，你可以根据你的需求来设置自己的网段。</p>\n<pre><code>路由器 IP: 192.168.1.1\nDHCP 范围: 192.168.1.101-192.168.1.200\n局域网段: 192.168.1.0/24\n子网掩码: 255.255.255.0\n网关机 IP: 192.168.1.2\nDocker 容器机 IP: 192.168.1.3\n</code></pre>\n<h3>网关机</h3>\n<p>首先要准备一下 PaoPaoGateWay 的系统镜像，由于是在物理机运行，所以需要全网卡驱动的支持。官方 Github 上的镜像是默认不带全网卡驱动的，需要我们用官方的 docker 来定制一下 ios 镜像。\n定制方式非常简单，随便找一台 x86 的装有 docker 的机器(官方容器不支持 arm)，运行下面两条命令，就能在当前目录获得一个具有全部网卡的 ios 镜像了。</p>\n<pre><code class=\"language-shell\">docker pull sliamb/ppgwiso:fullmod\ndocker run --rm -v .:/data sliamb/ppgwiso:fullmod\n</code></pre>\n<p>如果你不方便定制，也可以下载我定制好的镜像文件(记得解压)。</p>\n<p><a href=\"https://github.com/mouyase/PaoPaoGateWay/releases/download/20240812-9eb91d3/paopao-gateway-x86-64-custom-364b136.zip\" rel=\"nofollow\">paopao-gateway-x86-64-custom-364b136.zip</a></p>\n<p>准备一个写磁盘的工具，Rufus 、balenaEtcher 、UltraISO 之类的都可以，我这里使用 Rufus 。\n准备一个 U 盘，将镜像文件写入到 U 盘里。</p>\n<p>然后将 U 盘插入 x86 小主机，在 Bios 里设置为从 U 盘启动系统，通电自动启动系统，最后用网线将网口和路由器的 Lan 口进行连接。</p>\n<p>这样网关机这里就算设置完成了。</p>\n<p><strong>注:</strong></p>\n<ul>\n<li>如果有条件可以将网关机接上屏幕开机测试一下，看看能不能正常启动开机看到日志。</li>\n<li>系统测试稳定之后，可以尝试用 PE 将 ISO 镜像写入到系统内置磁盘里，这样就可以不插 U 盘启动了，不过这样后面更新会稍微麻烦点。</li>\n</ul>\n<h3>Docker 机</h3>\n<p>首先搭建好 Docker 环境，这里根据不同的设备和系统会有不同的方法，请根据网络上的教程自行操作。</p>\n<p>创建目录 DNS ，并且在其中创建<code>docker-compose.yaml</code>文件，用于配置容器。</p>\n<p><code>docker-compose.yaml</code>文件内容参考如下。</p>\n<pre><code class=\"language-yaml\">services:\n  paopaodns_china:\n    image: sliamb/paopaodns:latest\n    container_name: PaoPaoDNS-China\n    restart: always\n    volumes:\n      - ./PaoPaoDNS-China:/data\n    networks:\n      dns:\n        ipv4_address: 172.30.1.10 # IP 地址为 Docker 内网分配地址，用于内网访问\n    environment:\n      - TZ=Asia/Shanghai\n      - UPDATE=weekly\n      - DNS_SERVERNAME=PaoPaoDNS-China\n      - DNSPORT=53\n      - CNAUTO=no\n\n  paopaodns _global:\n    image: sliamb/paopaodns:latest\n    container_name: PaoPaoDNS-Global\n    restart: always\n    volumes:\n      - ./PaoPaoDNS-Global:/data\n    networks:\n      dns:\n        ipu4_address: 172.30.1.20 # IP 地址为 Docker 内网分配地址，用于内网访问\n    environment:\n      - TZ=Asia/Shanghai\n      - UPDATE=weekly\n      - DNS_SERVERNAME=PaoPaoDNS-Global\n      - DNSPORT=53\n      - CNAUTO=yes\n      - CNFALL=yes\n      - CN_TRACKER=yes\n      - USE_HOSTS=no\n      - IPU6=no\n      - SOCKS5=192.168.1.2:1080 # IP 地址为网关机的 IP 地址\n      - SERVER_IP=192.168.1.3 # IP 地址为本台宿主机的 IP 地址\n      - CUSTOM_FORWARD=192.168.1.2:53 # IP 地址为网关机的 IP 地址\n      - AUTO_FORWARD=yes\n      - AUTO_FORWARD_CHECK=yes\n      - USE_MARK_DATA=yes\n      - HTTP_FILE=yes\n    ports:\n      - \"5304:5304/udp\"\n      - \"5304:5304/tcp\"\n      - \"7889:7889/tcp\"\n\n  adguard_home:\n    image: adguard/adguardhome:latest\n    container_name: AdGuardHome\n    restart: always\n    depends_on:\n    - paopaodns_china\n    - paopaodns_global\n    volumes:\n    - ./AdGuardHome:/opt/adguardhome/work\n    - ./AdGuardHome:/opt/adguardhome/conf\n    networks:\n      dns:\n        ipv4_address: 172.30.1.2 # IP 地址为 Docker 内网分配地址，用于内网访问\n    environment:\n      - TZ=Asia/Shanghai\n    ports:\n      - \"53:53/udp\"\n      - \"53:53/tcp\"\n      - \"80:80/tcp\" # 如果不是使用 80 端口作为网页端口则需要添加对应的端口映射\n      - \"3000:3000/tcp\" # 安装成功后可以删除\n\nnetworks:\n  dns:\n    driver: bridge\n    ipam:\n      driver: default\n      config:\n        - subnet: 172.30.1.0/24\n          gateway: 172.30.1.1\n</code></pre>\n<p>解释一下这个配置文件。</p>\n<p>这个配置文件定义了三个容器。</p>\n<p>两个 PaoPaoDNS ，用来作为 AdguardHome 的上游 DNS ，其中一个容器没有做特殊的配置，仅当做本地递归 DNS 服务器使用。而另一台则添加了分流相关的设置，用于对需要出国的设备进行 DNS 分流处理。</p>\n<p>AdguardHome ，用于提供本地 DNS 服务，给不同的客户端配置不同的上游 DNS ，以及去广告(虽然是他的本职，但是这里反而成了附赠的功能了)。</p>\n<p>注: 爱快官方之前在论坛中提到，系统更新到 3.7.12 后，DHCP 设置将支持对不同的客户端配置不同的 DNS ，所以用爱快系统的可以根据需求不使用 AdguardHome 。</p>\n<p>接下来启动容器。</p>\n<pre><code class=\"language-shell\">docker compose up -d\n</code></pre>\n<p>容器正常启动后，则可以使用<code>本机 IP:3000</code>访问 AdguardHome 的安装页面了，设置一下用户名和密码，以及 WebUI 的端口(建议 80)即可。</p>\n<h3>网络配置</h3>\n<p>因为我文章里是使用的 OpenWRT 作为路由系统，所以这里也是用 OpenWRT 来演示。</p>\n<p>启动网关机和 Docker 容器机，让他们的信息出现在你的路由器里面。</p>\n<p>首先要固定一下 IP 。</p>\n<p>打开 网络→DHCP/DNS→静态地址分配，将网关机的 IP 固定为<code>192.168.1.2</code>，将 Docker 机的 IP 固定为<code>192.168.1.3</code>。</p>\n<p>然后将 DHCP 默认的 DNS 设置为<code>192.168.1.3</code>(如果需要输入两个地址就都填一样的)。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719020618_1bb59a5cf2f75a5e.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719020618_1bb59a5cf2f75a5e.webp\"/></a></p>\n<p>接下来要设置网内设备的 DNS 。</p>\n<p>打开 网络→接口→lan→DHCP 服务器→高级设置，在 DHCP 选项中添加。</p>\n<pre><code class=\"language-code\">6,192.168.1.3\n</code></pre>\n<p>这个值就是你的 Docker 机的 IP 。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719050519_dcf9d4e16ce100ea.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719050519_dcf9d4e16ce100ea.webp\"/></a></p>\n<p>然后重启一下网关机和 Docker 机，让他们可以获取到新的 IP 和 DNS 。</p>\n<p>接下来网页打开 AdguardHome 的后台<a href=\"http://192.168.1.3\" rel=\"nofollow\" title=\"http://192.168.1.3\">http://192.168.1.3</a>，在 DNS 设置中，将上游 DNS 设置为<code>172.30.1.10</code>，并且关闭缓存。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719082383_16a1523166bd1ae9.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719082383_16a1523166bd1ae9.webp\"/></a></p>\n<p>这时我们可以试一下我们的 DNS 能否正常使用。</p>\n<pre><code class=\"language-shell\">nslookup whoami.03k.org 192.168.1.3\n服务器:  Unknown\nAddress:  192.168.1.3\n\n非权威应答:\n名称:    whoami.03k.org\nAddress:  123.234.123.234 #连接权威 DNS 服务器的 IP=你的宽带 IP\n</code></pre>\n<p>返回的地址如果是你的公网 IP 网段，就说明递归 DNS 已经生效了。</p>\n<p>接下来是设置静态路由，我们回到 OpenWRT 的界面。</p>\n<p>打开 网络→路由→静态 IPv4 路由，添加一条新的静态路由，类型<code>unicast</code>，目标<code>11.0.0.0/8</code>，网关<code>192.168.1.2</code>。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719092071_6e583d6e5568ccf3.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719092071_6e583d6e5568ccf3.webp\"/></a></p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719175972_96a852a85b5e3e8d.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719175972_96a852a85b5e3e8d.webp\"/></a></p>\n<p>最后要屏蔽掉对 FakeIP 的 NAT 。</p>\n<p>打开 网络→防火墙→通信规则，添加一条新的规则，源区域为<code>lan</code>，目标区域为<code>wan</code>，目标地址为<code>11.0.0.0/8</code>，操作为<code>丢弃</code>。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719135684_6f2f75e01f73364b.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719135684_6f2f75e01f73364b.webp\"/></a></p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719135961_b1a793f2fdf259c6.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719135961_b1a793f2fdf259c6.webp\"/></a></p>\n<p><strong>注:</strong></p>\n<p>如果有使用一些纯靠 IP 访问的软件(例如网飞、Telegram)，还需要把他们的 IP 端也设置相同的静态路由和通信规则中，比较长这里我就不写了，有需求的可以自行添加。</p>\n<p>到这里网络路由相关内容设置完毕。</p>\n<h3>网关配置</h3>\n<p>网关配置文件在 Docker 机器的<code>DNS/PaoPaoDNS-Global</code>目录中的<code>ppgw.ini</code>。</p>\n<pre><code class=\"language-ini\">#paopao-gateway\n\n# mode=socks5|ovpn|yaml|suburl|free\n# default: free\n# free: 直接出站不走代理\n# socks5: 使用 socks5 代理出站\n# ovpn: 使用 ovpn 代理出站\n# yaml: 使用 yaml 配置文件，yaml 配置文件在同目录下，文件名参考下面的 yamlfile\n# suburl: 使用订阅地址，最常见的应该就是这种了\nmode=suburl\n\n# Set fakeip's CIDR here\n# default: fake_cidr=7.0.0.0/8\n# FakeIP 的网段，如果要修改，请修改成看似是外网的空 IP 网段\nfake_cidr=11.0.0.0/8\n\n# Set your trusted DNS here\n# default: dns_ip=1.0.0.1\n# 这里需要和 Docker 机，也就是 DNS 的 IP 匹配\ndns_ip=192.168.1.3\n# default: dns_port=53\n# If used with PaoPaoDNS, you can set the 5304 port\n# 这是网关获取配置的端口，如果没有修改过端口映射，请使用默认值\ndns_port=5304\n\n# Clash's web dashboard\n# 这是网页管理面板的端口和密码\nclash_web_port=\"80\"\nclash_web_password=\"clashpass\"\n\n# default：openport=no\n# socks+http mixed 1080\nopenport=no\n\n# default: udp_enable=no\nudp_enable=no\n\n# default:30\nsleeptime=30\n\n# socks5 mode settting\n# default: socks5_ip=gatewayIP\n# 这里需要填入网关 IP ，用于开启局域网内的 socks5 代理\nsocks5_ip=\"192.168.1.2\"\n# default: socks5_port=\"7890\"\nsocks5_port=\"7890\"\n\n# ovpn mode settting\n# The ovpn file in the same directory as the ppgw.ini.\n# default: ovpnfile=custom.ovpn\novpnfile=\"custom.ovpn\"\novpn_username=\"\"\novpn_password=\"\"\n\n# yaml mode settting\n# The yaml file in the same directory as the ppgw.ini.\n# default: yamlfile=custom.yaml\n# 这里是 yaml 模式时，网关获取的配置文件的文件名\nyamlfile=\"custom.yaml\"\n\n# suburl mode settting\n# 这里填入你的订阅地址\nsuburl=\"https://...\"\n# 这里是订阅自动更新时间\nsubtime=1d\n\n# fast_node=check/yes/no\n# check: 代表会自动检查下面的 URL 能否访问，如果不能访问则自动重启服务并重新拉取订阅\n# yes: 代表会自动根据延迟切换到延迟最低的节点，同时具有 check 的功能\n# no: 代表不检查延迟与连通性\nfast_node=yes\ntest_node_url=\"https://www.youtube.com/generate_204\"\next_node=\"Traffic|Expire| GB|Days|Date\"\ncpudelay=\"3000\"\n\n# dns burn setting\n# depend on fast_node=yes &amp; mode=suburl/yaml\ndns_burn=no\n# If used with PaoPaoDNS, you can set the PaoPaoDNS:53\n# 这里需要设置成 DNS 的 IP\nex_dns=\"192.168.1.3:53\"\n\n# Network traffic records\nnet_rec=no\nmax_rec=5000\n</code></pre>\n<p>更详细的参数解释，以及自定义规则等等，请参考<a href=\"https://github.com/kkkgo/PaoPaoGateWay#ppgwini%E9%85%8D%E7%BD%AE%E8%AF%B4%E6%98%8E\" rel=\"nofollow\">官方的文档</a>，如果没有特殊需求，按本文的配置即可。</p>\n<h3>配置设备 DNS</h3>\n<p>我的教程中的方案，是建立在网内只有一部分设备出国，另一部分正常用网的场景，所以需要针对不同的设备，设置不同的上游 DNS 服务器。</p>\n<p>如果你没有这种需求，可以直接在网络配置那一步中，将上游 DNS 设置为<code>172.30.1.20</code>，就不用继续往下看了。</p>\n<p>如果你也像我一样，只需要部分的设备走出国规则，那就还需要在多一步设置。</p>\n<p>打开 AdguardHome 的后台<a href=\"http://192.168.1.3\" rel=\"nofollow\" title=\"http://192.168.1.3\">http://192.168.1.3</a>。</p>\n<p>打开客户端设置，添加客户端。</p>\n<p>添加需要出国的设备的 IP 或者 IP 段，然后在下面的自定义上游的地方，将上游 DNS 设置为<code>172.30.1.20</code>，然后保存即可。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719181210_2f4c713455403fc7.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719181210_2f4c713455403fc7.webp\"/></a></p>\n<p>至此系统全部搭建完毕。</p>\n<h2>测试</h2>\n<p>可以使用 Speedtest ，分别选择国内和国外的测速节点，看一下带宽能否跑满。</p>\n<p>可以在<a href=\"https://ip111.cn\" rel=\"nofollow\" title=\"https://ip111.cn\">https://ip111.cn</a>或者<a href=\"https://ip.skk.moe\" rel=\"nofollow\" title=\"https://ip.skk.moe\">https://ip.skk.moe</a>检查一下 IP 分流是否正常。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719210259_aac670543d7d5533.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719210259_aac670543d7d5533.webp\"/></a></p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719210965_2772b3be94a07bb8.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719210965_2772b3be94a07bb8.webp\"/></a></p>\n<p>可以用 NatTypeTester 检查一下 Nat 等级。</p>\n<p><a href=\"https://yojigen.tech/wp-content/uploads/2024091719214622_af3abad9fd9dabd4.webp\" rel=\"nofollow\"><img alt=\"\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://yojigen.tech/wp-content/uploads/2024091719214622_af3abad9fd9dabd4.webp\"/></a></p>\n<h2>总结</h2>\n<p>整套设备花费是 59+28+50=137 元，这里是没有计算 U 盘和交换机的价格。</p>\n<p>U 盘作为一个搞机佬，我相信各位家里一定会有的，而交换机要看自己网内具体有多少需要网线的设备，所以我就没有算在内。</p>\n<p>这里面路由器的价格可能会有一些上下波动，比如你需要一款可以跑满千兆的路由器，又不想刷机，所以可能买了我推荐的爱快 Q3000 ，那价格就一下多了 100 元了，但是你买了更好的路由器就算不玩这套系统，那也可以让网络体验变好，也是不亏。而如果你家的网络没有达到千兆，比如只有 500M 甚至 100M ，那你大可买一些 mt7621 的路由器，刷个 OP 或者爱快的固件，这种路由器咸鱼 50 以内可以随便买。</p>\n<p>希望这篇文章可以帮助到一直想要一套舒适的网络的你。</p>\n", "last_modified": 1726628155, "replies": 85, "id": 1073554}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/a4a0/42cf/171_large.png?m=1630576706", "name": "invest", "avatar_normal": "https://cdn.v2ex.com/navatar/a4a0/42cf/171_normal.png?m=1630576706", "title": "投资", "url": "https://www.v2ex.com/go/invest", "topics": 1764, "footer": "", "header": "Can you make money with money?", "title_alternative": "Invest", "avatar_mini": "https://cdn.v2ex.com/navatar/a4a0/42cf/171_mini.png?m=1630576706", "stars": 2911, "aliases": [], "root": false, "id": 171, "parent_node_name": "money"}, "member": {"id": 300004, "username": "qq1147", "url": "https://www.v2ex.com/u/qq1147", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/352306d963150f8c63a864c26336b86b?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/352306d963150f8c63a864c26336b86b?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/352306d963150f8c63a864c26336b86b?s=73&d=retro", "created": 1521010586, "last_modified": 1702998140}, "last_reply_by": "kandaakihito", "last_touched": 1726677969, "title": "降息还是加息？留下你的预测", "url": "https://www.v2ex.com/t/1073596", "created": 1726624752, "deleted": 0, "content": "美联储将在北京时间 9 月 19 日周四凌晨 2 点公布 9 月利率决议，你认为会降还是加？多少个点？留下你的预测", "content_rendered": "<p>美联储将在北京时间 9 月 19 日周四凌晨 2 点公布 9 月利率决议，你认为会降还是加？多少个点？留下你的预测</p>\n", "last_modified": 1726628338, "replies": 71, "id": 1073596}]