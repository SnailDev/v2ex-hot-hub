[{"node": {"avatar_large": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1659331259", "name": "programmer", "avatar_normal": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1659331259", "title": "程序员", "url": "https://www.v2ex.com/go/programmer", "topics": 50683, "footer": "", "header": "While code monkeys are not eating bananas, they're coding.", "title_alternative": "Programmer", "avatar_mini": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1659331259", "stars": 7968, "aliases": [], "root": false, "id": 300, "parent_node_name": "computer"}, "member": {"id": 426922, "username": "ZhiyuanLin", "url": "https://www.v2ex.com/u/ZhiyuanLin", "website": "", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/46c5/02bf/426922_mini.png?m=1570871118", "avatar_normal": "https://cdn.v2ex.com/avatar/46c5/02bf/426922_normal.png?m=1570871118", "avatar_large": "https://cdn.v2ex.com/avatar/46c5/02bf/426922_large.png?m=1570871118", "created": 1562248667, "last_modified": 1570871118}, "last_reply_by": "XiaoBaiYa", "last_touched": 1662348531, "title": "知乎喜迎全平台隐写水印", "url": "https://www.v2ex.com/t/877614", "created": 1662275382, "deleted": 0, "content": "网页端或 app 端登录后截图可见\r\n\r\nhttps://stegonline.iculture.cc/\r\n\r\n验证可以这个工具的 Random Color Map 模式。\r\n\r\n比较好奇这是怎么实现的，CSS 和 HTML 里找不到痕迹，但是禁用 JavaScript 后会消失。\r\n\r\n这是如何做到添加了文本元素但是浏览器审查元素中看不到的？", "content_rendered": "<p>网页端或 app 端登录后截图可见</p>\n<p><a href=\"https://stegonline.iculture.cc/\" rel=\"nofollow\">https://stegonline.iculture.cc/</a></p>\n<p>验证可以这个工具的 Random Color Map 模式。</p>\n<p>比较好奇这是怎么实现的，CSS 和 HTML 里找不到痕迹，但是禁用 JavaScript 后会消失。</p>\n<p>这是如何做到添加了文本元素但是浏览器审查元素中看不到的？</p>\n", "last_modified": 1662275382, "replies": 187, "id": 877614}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/093f/65e0/59_large.png?m=1615956453", "name": "random", "avatar_normal": "https://cdn.v2ex.com/navatar/093f/65e0/59_normal.png?m=1615956453", "title": "随想", "url": "https://www.v2ex.com/go/random", "topics": 3278, "footer": "", "header": "有的时候，可以停下来找找灵感，然后再继续。", "title_alternative": "Random", "avatar_mini": "https://cdn.v2ex.com/navatar/093f/65e0/59_mini.png?m=1615956453", "stars": 1066, "aliases": [], "root": false, "id": 59, "parent_node_name": "v2ex"}, "member": {"id": 591500, "username": "solohealer", "url": "https://www.v2ex.com/u/solohealer", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/7e9a05415228b7ff1f26c82d7f26fc4d?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/7e9a05415228b7ff1f26c82d7f26fc4d?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/7e9a05415228b7ff1f26c82d7f26fc4d?s=73&d=retro", "created": 1660718958, "last_modified": 1660718958}, "last_reply_by": "Sisyphe42", "last_touched": 1662348747, "title": "uu 们都在用啥笔记软件？", "url": "https://www.v2ex.com/t/877596", "created": 1662267585, "deleted": 0, "content": "闲来无事水贴", "content_rendered": "<p>闲来无事水贴</p>\n", "last_modified": 1662267585, "replies": 101, "id": 877596}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/093f/65e0/59_large.png?m=1615956453", "name": "random", "avatar_normal": "https://cdn.v2ex.com/navatar/093f/65e0/59_normal.png?m=1615956453", "title": "随想", "url": "https://www.v2ex.com/go/random", "topics": 3278, "footer": "", "header": "有的时候，可以停下来找找灵感，然后再继续。", "title_alternative": "Random", "avatar_mini": "https://cdn.v2ex.com/navatar/093f/65e0/59_mini.png?m=1615956453", "stars": 1066, "aliases": [], "root": false, "id": 59, "parent_node_name": "v2ex"}, "member": {"id": 472807, "username": "yuxi521", "url": "https://www.v2ex.com/u/yuxi521", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/1c549167450d93f5bd9f8b3a0fa34f3d?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/1c549167450d93f5bd9f8b3a0fa34f3d?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/1c549167450d93f5bd9f8b3a0fa34f3d?s=73&d=retro", "created": 1582798987, "last_modified": 1654489976}, "last_reply_by": "tutu2000", "last_touched": 1662348622, "title": "看这样子。中秋也不能出京了", "url": "https://www.v2ex.com/t/877580", "created": 1662262661, "deleted": 0, "content": "问一下北京的友友们中秋节有出行计划吗。\r\n\r\n上个月就和女朋友计划中秋去青岛玩。1 昨天社区通知只要是返京就要报备了。不管从哪来的。2 市区县有一例就不能返京了。恰好青岛有一个。3 公司也发通知离京返京需要审批。感觉出去容易。回来也很难了。万一再来个健康宝弹窗。那真是。。。啊。三年了。只去过工作地点和老家。有一年春节也没回去，其他哪也没去过了。做了好久的路书。订票。订酒店。甚至想好了每天做一次核酸。哎。已经在犹豫了，被劝退了。不怕自己得病。不怕自己被隔离。就怕因为自己给其他人还有小区还有公司造成额外影响。真难。\r\n\r\n\r\n\r\nps：单纯的打工仔的吐槽。没任何想法。希望大佬们不要吵起来。不然又水深火热了", "content_rendered": "<p>问一下北京的友友们中秋节有出行计划吗。</p>\n<p>上个月就和女朋友计划中秋去青岛玩。1 昨天社区通知只要是返京就要报备了。不管从哪来的。2 市区县有一例就不能返京了。恰好青岛有一个。3 公司也发通知离京返京需要审批。感觉出去容易。回来也很难了。万一再来个健康宝弹窗。那真是。。。啊。三年了。只去过工作地点和老家。有一年春节也没回去，其他哪也没去过了。做了好久的路书。订票。订酒店。甚至想好了每天做一次核酸。哎。已经在犹豫了，被劝退了。不怕自己得病。不怕自己被隔离。就怕因为自己给其他人还有小区还有公司造成额外影响。真难。</p>\n<p>ps：单纯的打工仔的吐槽。没任何想法。希望大佬们不要吵起来。不然又水深火热了</p>\n", "last_modified": 1662265791, "replies": 79, "id": 877580}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/4299/8cf3/457_large.png?m=1583583838", "name": "gamedev", "avatar_normal": "https://cdn.v2ex.com/navatar/4299/8cf3/457_normal.png?m=1583583838", "title": "游戏开发", "url": "https://www.v2ex.com/go/gamedev", "topics": 308, "footer": "", "header": "无论你正在制作自己的 indie game，或是在大公司参与 AAA 大作，这里是大家讨论技术和理念的地方。", "title_alternative": "Game Development", "avatar_mini": "https://cdn.v2ex.com/navatar/4299/8cf3/457_mini.png?m=1583583838", "stars": 520, "aliases": [], "root": false, "id": 457, "parent_node_name": "programmer"}, "member": {"id": 589481, "username": "edis0n0", "url": "https://www.v2ex.com/u/edis0n0", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/8acfb030e98c7c3f424344dfb6eb8512?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/8acfb030e98c7c3f424344dfb6eb8512?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/8acfb030e98c7c3f424344dfb6eb8512?s=73&d=retro", "created": 1659166771, "last_modified": 1659970243}, "last_reply_by": "kepenj", "last_touched": 1662348685, "title": "为什么游戏玩家少了就要关服？", "url": "https://www.v2ex.com/t/877671", "created": 1662295854, "deleted": 0, "content": "服务器成本能有多高，留一两个人运营，或是直接不运营招一个低价兼*职服务器运维，纯收钱不行吗？\r\n\r\n（非游戏行业从业者，一直想不通的问题）", "content_rendered": "服务器成本能有多高，留一两个人运营，或是直接不运营招一个低价兼*职服务器运维，纯收钱不行吗？<br /><br />（非游戏行业从业者，一直想不通的问题）", "last_modified": 1662295854, "replies": 57, "id": 877671}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c9f0/f895/8_large.png?m=1630643991", "name": "iphone", "avatar_normal": "https://cdn.v2ex.com/navatar/c9f0/f895/8_normal.png?m=1630643991", "title": "iPhone", "url": "https://www.v2ex.com/go/iphone", "topics": 9544, "footer": "这里绝不讨论如何获得 iPhone 盗版软件、iTunes 黑卡之类。", "header": "Say hello to the future.", "title_alternative": "iPhone", "avatar_mini": "https://cdn.v2ex.com/navatar/c9f0/f895/8_mini.png?m=1630643991", "stars": 2946, "aliases": [], "root": false, "id": 8, "parent_node_name": "apple"}, "member": {"id": 72587, "username": "sutking", "url": "https://www.v2ex.com/u/sutking", "website": "", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/286b/1d8c/72587_mini.png?m=1567393123", "avatar_normal": "https://cdn.v2ex.com/avatar/286b/1d8c/72587_normal.png?m=1567393123", "avatar_large": "https://cdn.v2ex.com/avatar/286b/1d8c/72587_large.png?m=1567393123", "created": 1409541286, "last_modified": 1567393123}, "last_reply_by": "Joker123456789", "last_touched": 1662346568, "title": "既然信号不好，那就干脆不插 SIM 卡了！", "url": "https://www.v2ex.com/t/877634", "created": 1662284061, "deleted": 0, "content": "昨天带孩子到市郊玩，恰巧所处的位置手机信号不太好，当时正在用 iPhone 给孩子拍视频，手机突然弹出了这个画面（截图是后补的）：\r\n\r\n<img src=\"https://s3.bmp.ovh/imgs/2022/09/04/da2be2702c4491a9.png\" width = \"10\" alt=\"img\" align=center />\r\n\r\n然后拍摄就被打断了，正好错过了牙牙学语的孩子张口说话的精彩瞬间，非常气愤，回到家后就萌生了一个想法：\r\n<br>\r\n如果一个 iPhone 从买到手拆开包装的那一刻一直到它生命的终结一直都不插 SIM 卡，会怎样呢？🤔\r\n<br>\r\niPhone 本来信号就不好再加上电池续航也是蛋疼，每到信号不稳定的地方耗电量就更加夸张，如果让 iPhone 一直连着 WiFi 岂不是解决了这个问题？🤔iPhone 的这几个缺陷现在随便一个安卓机都强得多，续航都牛逼到不行、快充也是猛的一批、信号大概也比 iPhone 强，做个双机党有何不可（不用说那干脆用安卓机得了！ iPhone 是最好用的手机没有之一，不接受反驳！）？<br>\r\n你们觉得如何？<br>\r\n我打算先试试看，说不定过段时间回来更新体验。", "content_rendered": "<p>昨天带孩子到市郊玩，恰巧所处的位置手机信号不太好，当时正在用 iPhone 给孩子拍视频，手机突然弹出了这个画面（截图是后补的）：</p>\n<img alt=\"img\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://s3.bmp.ovh/imgs/2022/09/04/da2be2702c4491a9.png\"/>\n<p>然后拍摄就被打断了，正好错过了牙牙学语的孩子张口说话的精彩瞬间，非常气愤，回到家后就萌生了一个想法：\n<br/>\n如果一个 iPhone 从买到手拆开包装的那一刻一直到它生命的终结一直都不插 SIM 卡，会怎样呢？🤔\n<br/>\niPhone 本来信号就不好再加上电池续航也是蛋疼，每到信号不稳定的地方耗电量就更加夸张，如果让 iPhone 一直连着 WiFi 岂不是解决了这个问题？🤔iPhone 的这几个缺陷现在随便一个安卓机都强得多，续航都牛逼到不行、快充也是猛的一批、信号大概也比 iPhone 强，做个双机党有何不可（不用说那干脆用安卓机得了！ iPhone 是最好用的手机没有之一，不接受反驳！）？<br/>\n你们觉得如何？<br/>\n我打算先试试看，说不定过段时间回来更新体验。</p>\n", "last_modified": 1662284061, "replies": 55, "id": 877634}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/d67d/8ab4/39_large.png?m=1651385965", "name": "android", "avatar_normal": "https://cdn.v2ex.com/navatar/d67d/8ab4/39_normal.png?m=1651385965", "title": "Android", "url": "https://www.v2ex.com/go/android", "topics": 9677, "footer": "", "header": "来自 <a href=\"/go/google\">Google</a> 的开放源代码智能手机平台。", "title_alternative": "Android", "avatar_mini": "https://cdn.v2ex.com/navatar/d67d/8ab4/39_mini.png?m=1651385965", "stars": 5136, "aliases": [], "root": false, "id": 39, "parent_node_name": "hardware"}, "member": {"id": 444149, "username": "AirShark", "url": "https://www.v2ex.com/u/AirShark", "website": "", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/d510f9edd10bd8e9769cce1679d93345?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/d510f9edd10bd8e9769cce1679d93345?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/d510f9edd10bd8e9769cce1679d93345?s=73&d=retro", "created": 1569810169, "last_modified": 1569810169}, "last_reply_by": "um1ng", "last_touched": 1662345568, "title": "请求推荐手机（不装国内软件）", "url": "https://www.v2ex.com/t/877597", "created": 1662267674, "deleted": 0, "content": "1.只推荐 Android ，不推荐苹果\r\n现在生活在国外，国内 app （例如微信、银行、支付等）一周最多只会用一次。已经有一个 iPhone XR ，这部手机打算专门用来装国内软件，利用苹果的强大权限管理功能来管好国产软件。苹果的信号也比较差，打算就用来做备用机。\r\n\r\n2.原因\r\n目前用的是小米 Mix2S 和 iPhone XR ，两种系统对我的优缺点主要体现在：\r\n苹果：Apple Pay 支持的发卡机构、在线商户比 Google Pay 多。消息推送不需要 app 常驻后台。App 滥用权限能够得到管控。\r\n安卓：WhatsApp 、MS Auth 等备份都是安卓备份到 G Drive ，苹果备份到 iCloud ，导致一些 App 一开始都装在安卓上的迁移很困难。这类软件我有 6 个，尤其是通讯类的，不想丢掉记录。Firefox 可以安装插件，不想换 Edge 。可以同时登录多个不同国家 Google 账号。\r\n\r\n3.手机推荐\r\n想要找一部安卓机，但是不要国内品牌的，例如小米海外版也不要。\r\n居住在新西兰，偶尔去澳大利亚，主要品牌应该都能买到。\r\n因为是安卓原生系统，也只装国外软件，所以 FCM 推送，滥用权限问题就能得到解决。\r\n不在国内用，所以在国内不能用 5G 也无所谓。\r\n\r\n对比过几个品牌：\r\nNokia：价格便宜，但只是富士康旗下品牌，不是太想要。\r\nSamsung：价格比偏贵。有自己的全家桶（应用商店、云、语音助手、钱包），担心像小米那样雀占鸠巢（ Google 全家桶）。\r\nPixel 6：自己的芯片，不知道如何？尤其是信号方面。摄像头凸出也卡口袋。\r\nPixel 5a with 5G：最后一代用高通，摄像头也没有凸出，体验是否也优于 6 ？\r\n\r\n其实比较偏向买 Pixel ，Google 自家的一些功能可能优化更好？尤其是 Google Pay 。\r\n\r\n4.必需要的功能\r\nWiFi Calling\r\n\r\n5.预算 8k CNY 以内。\r\n\r\n\r\n大佬们有推荐的手机型号吗？", "content_rendered": "<p>1.只推荐 Android ，不推荐苹果\n现在生活在国外，国内 app （例如微信、银行、支付等）一周最多只会用一次。已经有一个 iPhone XR ，这部手机打算专门用来装国内软件，利用苹果的强大权限管理功能来管好国产软件。苹果的信号也比较差，打算就用来做备用机。</p>\n<p>2.原因\n目前用的是小米 Mix2S 和 iPhone XR ，两种系统对我的优缺点主要体现在：\n苹果：Apple Pay 支持的发卡机构、在线商户比 Google Pay 多。消息推送不需要 app 常驻后台。App 滥用权限能够得到管控。\n安卓：WhatsApp 、MS Auth 等备份都是安卓备份到 G Drive ，苹果备份到 iCloud ，导致一些 App 一开始都装在安卓上的迁移很困难。这类软件我有 6 个，尤其是通讯类的，不想丢掉记录。Firefox 可以安装插件，不想换 Edge 。可以同时登录多个不同国家 Google 账号。</p>\n<p>3.手机推荐\n想要找一部安卓机，但是不要国内品牌的，例如小米海外版也不要。\n居住在新西兰，偶尔去澳大利亚，主要品牌应该都能买到。\n因为是安卓原生系统，也只装国外软件，所以 FCM 推送，滥用权限问题就能得到解决。\n不在国内用，所以在国内不能用 5G 也无所谓。</p>\n<p>对比过几个品牌：\nNokia：价格便宜，但只是富士康旗下品牌，不是太想要。\nSamsung：价格比偏贵。有自己的全家桶（应用商店、云、语音助手、钱包），担心像小米那样雀占鸠巢（ Google 全家桶）。\nPixel 6：自己的芯片，不知道如何？尤其是信号方面。摄像头凸出也卡口袋。\nPixel 5a with 5G：最后一代用高通，摄像头也没有凸出，体验是否也优于 6 ？</p>\n<p>其实比较偏向买 Pixel ，Google 自家的一些功能可能优化更好？尤其是 Google Pay 。</p>\n<p>4.必需要的功能\nWiFi Calling</p>\n<p>5.预算 8k CNY 以内。</p>\n<p>大佬们有推荐的手机型号吗？</p>\n", "last_modified": 1662268143, "replies": 54, "id": 877597}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/70ef/df2e/17_large.png?m=1660301119", "name": "create", "avatar_normal": "https://cdn.v2ex.com/navatar/70ef/df2e/17_normal.png?m=1660301119", "title": "分享创造", "url": "https://www.v2ex.com/go/create", "topics": 18362, "footer": "", "header": "欢迎你在这里发布自己的最新作品！", "title_alternative": "Create", "avatar_mini": "https://cdn.v2ex.com/navatar/70ef/df2e/17_mini.png?m=1660301119", "stars": 4510, "aliases": [], "root": false, "id": 17, "parent_node_name": "geek"}, "member": {"id": 148974, "username": "star7th", "url": "https://www.v2ex.com/u/star7th", "website": "http://blog.star7th.com/", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "前端、PHP、node.js和Linux", "avatar_mini": "https://cdn.v2ex.com/gravatar/28688ae0c93f06c9f73a3e6ba79e0508?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/28688ae0c93f06c9f73a3e6ba79e0508?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/28688ae0c93f06c9f73a3e6ba79e0508?s=73&d=retro", "created": 1448637932, "last_modified": 1648098744}, "last_reply_by": "airqj", "last_touched": 1662348666, "title": "我是如何把网站图片 cdn 流量成本压到全网最低(之一)的", "url": "https://www.v2ex.com/t/877718", "created": 1662341564, "deleted": 0, "content": "### 缘起\r\n      \r\n我经营的一些网站和产品的访问量越来越高，付出的 cdn 流量成本（主要是图片资源）也越来越大。抱着节省成本的想法，我尝试在网络上找下有没有便宜的 cdn 商家。 像阿里云、腾讯云、七牛云，这些公有云 cdn 的价格都大同小异，我感觉即使从这一家换到另一家，也节省不了多少成本，同时还增加了迁移的麻烦。因此我把目光投向传统机房，预感可能越接近机器底层，能优化的空间越大。\r\n\r\n经过几天的考察，发现很多非热门地区的机房都或多或少都有一些闲置的优惠产品，甚至其中也不乏优质带宽机器。特别是三四线机房，线路测试其实还不错。很明显这些闲置资源没有得到充分利用。一个点子在我脑海中酝酿了。\r\n\r\n  \r\n### 使用开源 or 自己原创？\r\n\r\n假如我把各地的闲置机器组织起来，把它们当成一个个节点，组建起一个分布式网络，自动容灾切换，岂不就是一个廉价的自建 cdn 方案了？ 顺着这个思路，我去找一下开源的 cdn 软件 ，看看有没有现成的解决方案。\r\n\r\n然而事情没有我想的那么简单。开源 cdn 并没有很好的容灾切换机制，无法实时避障。 它核心原理里，用域名 cname 的方式指向某个节点 ip ，当节点挂了的时候，由于域名 cname 解析变更有 10 分钟以上的缓存，所以必定会导致用户有一段时间的访问故障。\r\n我现在探索的是把各地机房集成到一起，其中机器节点的可靠性是参差不齐的。如果想做成一套 cdn ，那么就必须要假设节点是不可靠的，随时可能故障的，然后为此设计一套完善的容灾解决方案。\r\n\r\n既然找不到现成的开源解决方案，那就自己动手写代码实现吧。\r\n\r\n### 基本逻辑\r\n\r\n我边啃着玉米，边用笔在纸上画着逻辑交互图。 经过一阵子的反复斟酌，基本逻辑已经成型。 \r\n\r\n1 ，这套程序主要有两个角色，调度服务器和节点服务器。调度服务器架设在阿里云 k8s 上，保障高可用。而节点服务器则是分布在各地机房，做好可能会故障、随时容灾切换的准备。\r\n\r\n2 ，调度服务器的作用是导流和容灾，将用户流量以重定向的方式导向可用的节点，同时避开故障节点，做到实时无缝切换。\r\n\r\n3 ，节点服务器的主要作用是拉取源文件到本地缓存，从而被用户访问。\r\n\r\n4 ，节点服务器跟调度服务器之间要用某 tcp 协议实时连接监控，监控粒度细分到每个文件，方便调度服务器实时避开故障节点，这样才能保证故障时候，用户访问的每个链接都可以正常切换访问。这里实时性是非常重要的，也是容灾方案的核心。\r\n\r\n\r\n### 小试牛刀\r\n\r\n于是我花了一个多月的时间去写代码来实现这个逻辑。核心代码其实写得很快，但是为了保障稳定性，增加了非常多的异常容灾措施，要花时间不断测试不断重写。 初期只放三个异地机房节点，把流量切进来看看。\r\n为了保险起见，先从小的做起。我一开始切日均 10G 流量过去，让它跑几天。\r\n几天后，没问题。\r\n试试日均 50G 流量？  50G 跑了几天，ok 。日均 300G ？ 依然正常运行 。\r\n\r\n### 开放商用\r\n\r\n现在，已经完美运行了一个月，每天承受超过 1000G 流量，暂时没发现有故障现象。我以及一些朋友的很多产品都在用。我刻意关掉其中一个节点，调度服务器马上切流量到其他节点。我刻意关闭全部节点，流量也马上转到源站。整个过程中，只要调度服务器正常运作，那么，无论节点故障与否，用户都将继续无感知地正常访问图片。 而调度服务器直接运行在阿里云 k8s 上，可靠性是非常高的。因此整套架构的可靠性很高。\r\n\r\n有了这个架构，如果需要承受更大流量，我只需要增加节点数即可。而全国范围内的机房机器多的是 ，我可以随时租机器来新增节点。当我意识到有规模化运作大流量的可能性后， 我决定把 cdn 能力包装出去 ，商业化运作。于是注册并备案了大风云网， 访问地址是  [www.dfyun.com.cn]( https://www.dfyun.com.cn  \"www.dfyun.com.cn\") \r\n        \r\n### 结语\r\n\r\n大风云[ www.dfyun.com.cn ]( https://www.dfyun.com.cn  \" www.dfyun.com.cn \") 严格来讲不是传统 cdn ，它是另一种内容分发机制，基于传统 cdn 以及传统机房机器， 用软件技术实现资源整合，是应用层面的一种微创新，在图片访问，文件下载等这些场景下可以成倍地降低流量成本 ，成本低于 0.05G/元 ， 降低到公有云 cdn 价格的四分之一以下（只对比平时价格，不考虑搞活动的临时特价），几乎是全网 cdn 流量成本最低之一了。", "content_rendered": "<h3>缘起</h3>\n<p>我经营的一些网站和产品的访问量越来越高，付出的 cdn 流量成本（主要是图片资源）也越来越大。抱着节省成本的想法，我尝试在网络上找下有没有便宜的 cdn 商家。 像阿里云、腾讯云、七牛云，这些公有云 cdn 的价格都大同小异，我感觉即使从这一家换到另一家，也节省不了多少成本，同时还增加了迁移的麻烦。因此我把目光投向传统机房，预感可能越接近机器底层，能优化的空间越大。</p>\n<p>经过几天的考察，发现很多非热门地区的机房都或多或少都有一些闲置的优惠产品，甚至其中也不乏优质带宽机器。特别是三四线机房，线路测试其实还不错。很明显这些闲置资源没有得到充分利用。一个点子在我脑海中酝酿了。</p>\n<h3>使用开源 or 自己原创？</h3>\n<p>假如我把各地的闲置机器组织起来，把它们当成一个个节点，组建起一个分布式网络，自动容灾切换，岂不就是一个廉价的自建 cdn 方案了？ 顺着这个思路，我去找一下开源的 cdn 软件 ，看看有没有现成的解决方案。</p>\n<p>然而事情没有我想的那么简单。开源 cdn 并没有很好的容灾切换机制，无法实时避障。 它核心原理里，用域名 cname 的方式指向某个节点 ip ，当节点挂了的时候，由于域名 cname 解析变更有 10 分钟以上的缓存，所以必定会导致用户有一段时间的访问故障。\n我现在探索的是把各地机房集成到一起，其中机器节点的可靠性是参差不齐的。如果想做成一套 cdn ，那么就必须要假设节点是不可靠的，随时可能故障的，然后为此设计一套完善的容灾解决方案。</p>\n<p>既然找不到现成的开源解决方案，那就自己动手写代码实现吧。</p>\n<h3>基本逻辑</h3>\n<p>我边啃着玉米，边用笔在纸上画着逻辑交互图。 经过一阵子的反复斟酌，基本逻辑已经成型。 </p>\n<p>1 ，这套程序主要有两个角色，调度服务器和节点服务器。调度服务器架设在阿里云 k8s 上，保障高可用。而节点服务器则是分布在各地机房，做好可能会故障、随时容灾切换的准备。</p>\n<p>2 ，调度服务器的作用是导流和容灾，将用户流量以重定向的方式导向可用的节点，同时避开故障节点，做到实时无缝切换。</p>\n<p>3 ，节点服务器的主要作用是拉取源文件到本地缓存，从而被用户访问。</p>\n<p>4 ，节点服务器跟调度服务器之间要用某 tcp 协议实时连接监控，监控粒度细分到每个文件，方便调度服务器实时避开故障节点，这样才能保证故障时候，用户访问的每个链接都可以正常切换访问。这里实时性是非常重要的，也是容灾方案的核心。</p>\n<h3>小试牛刀</h3>\n<p>于是我花了一个多月的时间去写代码来实现这个逻辑。核心代码其实写得很快，但是为了保障稳定性，增加了非常多的异常容灾措施，要花时间不断测试不断重写。 初期只放三个异地机房节点，把流量切进来看看。\n为了保险起见，先从小的做起。我一开始切日均 10G 流量过去，让它跑几天。\n几天后，没问题。\n试试日均 50G 流量？  50G 跑了几天，ok 。日均 300G ？ 依然正常运行 。</p>\n<h3>开放商用</h3>\n<p>现在，已经完美运行了一个月，每天承受超过 1000G 流量，暂时没发现有故障现象。我以及一些朋友的很多产品都在用。我刻意关掉其中一个节点，调度服务器马上切流量到其他节点。我刻意关闭全部节点，流量也马上转到源站。整个过程中，只要调度服务器正常运作，那么，无论节点故障与否，用户都将继续无感知地正常访问图片。 而调度服务器直接运行在阿里云 k8s 上，可靠性是非常高的。因此整套架构的可靠性很高。</p>\n<p>有了这个架构，如果需要承受更大流量，我只需要增加节点数即可。而全国范围内的机房机器多的是 ，我可以随时租机器来新增节点。当我意识到有规模化运作大流量的可能性后， 我决定把 cdn 能力包装出去 ，商业化运作。于是注册并备案了大风云网， 访问地址是  <a href=\"https://www.dfyun.com.cn\" rel=\"nofollow\" title=\"www.dfyun.com.cn\">www.dfyun.com.cn</a> </p>\n<h3>结语</h3>\n<p>大风云<a href=\"https://www.dfyun.com.cn\" rel=\"nofollow\" title=\" www.dfyun.com.cn \"> </a><a href=\"http://www.dfyun.com.cn\" rel=\"nofollow\">www.dfyun.com.cn</a>  严格来讲不是传统 cdn ，它是另一种内容分发机制，基于传统 cdn 以及传统机房机器， 用软件技术实现资源整合，是应用层面的一种微创新，在图片访问，文件下载等这些场景下可以成倍地降低流量成本 ，成本低于 0.05G/元 ， 降低到公有云 cdn 价格的四分之一以下（只对比平时价格，不考虑搞活动的临时特价），几乎是全网 cdn 流量成本最低之一了。</p>\n", "last_modified": 1662341756, "replies": 52, "id": 877718}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 189621, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 3551, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 576704, "username": "airbotgo", "url": "https://www.v2ex.com/u/airbotgo", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/2d8f9a5b4fbddc9e8307b207222e9938?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/2d8f9a5b4fbddc9e8307b207222e9938?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/2d8f9a5b4fbddc9e8307b207222e9938?s=73&d=retro", "created": 1648272585, "last_modified": 1651624471}, "last_reply_by": "szqhades", "last_touched": 1662306853, "title": "腾讯这种行为是违规行为吗？", "url": "https://www.v2ex.com/t/877717", "created": 1662341434, "deleted": 0, "content": "1 、游戏故意多分区\r\n以王者荣耀为例，故意分出 iOS 、安卓、微信、QQ 四个组合分区，区之间账号隔离。目的是让用户重复消费。\r\n这种行为违规吗？\r\n\r\n2 、故意限制外区游戏\r\n以英雄联盟手游为例，外区英雄联盟手游，安卓、iOS 数据互通，且游戏内没有满天飞的广告。我玩外区（玩过美区、日区）必须挂梯子或加速器，否则无法连接服务器。\r\n这种行为违规吗？\r\n\r\n3 、游戏账号仅允许 QQ 、微信登录\r\n不能邮箱、游戏 ID 等其它登录方式，必须先下载它们的 QQ 、微信。\r\n这种行为违规吗？\r\n\r\n4 、付费用户遇到问题找不到真人客服\r\n提供的客服电话，从来没有打通过，对于付费用户来说，完全不能保障权益。\r\n这种行为违规吗？\r\n\r\n我天天祈祷腾讯倒闭。", "content_rendered": "1 、游戏故意多分区<br />以王者荣耀为例，故意分出 iOS 、安卓、微信、QQ 四个组合分区，区之间账号隔离。目的是让用户重复消费。<br />这种行为违规吗？<br /><br />2 、故意限制外区游戏<br />以英雄联盟手游为例，外区英雄联盟手游，安卓、iOS 数据互通，且游戏内没有满天飞的广告。我玩外区（玩过美区、日区）必须挂梯子或加速器，否则无法连接服务器。<br />这种行为违规吗？<br /><br />3 、游戏账号仅允许 QQ 、微信登录<br />不能邮箱、游戏 ID 等其它登录方式，必须先下载它们的 QQ 、微信。<br />这种行为违规吗？<br /><br />4 、付费用户遇到问题找不到真人客服<br />提供的客服电话，从来没有打通过，对于付费用户来说，完全不能保障权益。<br />这种行为违规吗？<br /><br />我天天祈祷腾讯倒闭。", "last_modified": 1662341434, "replies": 45, "id": 877717}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6353/8fe6/519_large.png?m=1595507885", "name": "ideas", "avatar_normal": "https://cdn.v2ex.com/navatar/6353/8fe6/519_normal.png?m=1595507885", "title": "奇思妙想", "url": "https://www.v2ex.com/go/ideas", "topics": 5128, "footer": "", "header": "让你的创意在这里自由流动吧。", "title_alternative": "Ideas", "avatar_mini": "https://cdn.v2ex.com/navatar/6353/8fe6/519_mini.png?m=1595507885", "stars": 2659, "aliases": [], "root": false, "id": 519, "parent_node_name": "v2ex"}, "member": {"id": 586033, "username": "Ansen678", "url": "https://www.v2ex.com/u/Ansen678", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/9dcf611a4d1c6407f946595c80282ea5?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/9dcf611a4d1c6407f946595c80282ea5?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/9dcf611a4d1c6407f946595c80282ea5?s=73&d=retro", "created": 1656233635, "last_modified": 1662272471}, "last_reply_by": "Patrick6", "last_touched": 1662347898, "title": "大姨妈 App 做好了，起名「来了么」", "url": "https://www.v2ex.com/t/877610", "created": 1662272740, "deleted": 0, "content": "前段时间征集了一个大姨妈软件的名字，最后取名[来了么]( https://www.v2ex.com/t/862574?p=1)。\r\n\r\n\r\n花了两个月的时间上架了，其实很早就做好了，只是一直在等软著，目前是单机版的（只支持安卓），不需要登录，也没有广告，就是一个简洁的女生记录大姨妈的软件。后续使用的人多才考虑加入服务器同步记录。\r\n\r\n目前上架了，Vivo 、Oppo 、小米市场。欢迎大家下载使用。[也可以点我下载 APK 文件]( https://image.srzs.top/apk/coming_1.0.0_build1.apk)\r\n\r\n\r\n![精准预测]( https://image.srzs.top/coming/phone1.png)\r\n\r\n![健康统计]( https://image.srzs.top/coming/phone2.png)\r\n\r\n![症状记录]( https://image.srzs.top/coming/phone3.png)", "content_rendered": "<p>前段时间征集了一个大姨妈软件的名字，最后取名<a href=\"https://www.v2ex.com/t/862574?p=1\" rel=\"nofollow\">来了么</a>。</p>\n<p>花了两个月的时间上架了，其实很早就做好了，只是一直在等软著，目前是单机版的（只支持安卓），不需要登录，也没有广告，就是一个简洁的女生记录大姨妈的软件。后续使用的人多才考虑加入服务器同步记录。</p>\n<p>目前上架了，Vivo 、Oppo 、小米市场。欢迎大家下载使用。<a href=\"https://image.srzs.top/apk/coming_1.0.0_build1.apk\" rel=\"nofollow\">也可以点我下载 APK 文件</a></p>\n<p><img alt=\"精准预测\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://image.srzs.top/coming/phone1.png\"/></p>\n<p><img alt=\"健康统计\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://image.srzs.top/coming/phone2.png\"/></p>\n<p><img alt=\"症状记录\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://image.srzs.top/coming/phone3.png\"/></p>\n", "last_modified": 1662272740, "replies": 41, "id": 877610}]