[{"node": {"avatar_large": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1646074667", "name": "programmer", "avatar_normal": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1646074667", "title": "程序员", "url": "https://www.v2ex.com/go/programmer", "topics": 47709, "footer": "", "header": "While code monkeys are not eating bananas, they're coding.", "title_alternative": "Programmer", "avatar_mini": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1646074667", "stars": 7727, "aliases": [], "root": false, "id": 300, "parent_node_name": "computer"}, "member": {"id": 550308, "username": "dwlovelife", "url": "https://www.v2ex.com/u/dwlovelife", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/6ce6/efba/550308_mini.png?m=1639637523", "avatar_normal": "https://cdn.v2ex.com/avatar/6ce6/efba/550308_normal.png?m=1639637523", "avatar_large": "https://cdn.v2ex.com/avatar/6ce6/efba/550308_large.png?m=1639637523", "created": 1625647757, "last_modified": 1639637523}, "last_reply_by": "cassiaesemen", "last_touched": 1646846418, "title": "最近一年大家基金、股票盈利情况", "url": "https://www.v2ex.com/t/839064", "created": 1646794677, "deleted": 0, "content": "买基金买了 4 万，亏了 6000 ，麻了", "content_rendered": "<p>买基金买了 4 万，亏了 6000 ，麻了</p>\n", "last_modified": 1646794677, "replies": 185, "id": 839064}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/70ef/df2e/17_large.png?m=1629391403", "name": "create", "avatar_normal": "https://cdn.v2ex.com/navatar/70ef/df2e/17_normal.png?m=1629391403", "title": "分享创造", "url": "https://www.v2ex.com/go/create", "topics": 17446, "footer": "", "header": "欢迎你在这里发布自己的最新作品！", "title_alternative": "Create", "avatar_mini": "https://cdn.v2ex.com/navatar/70ef/df2e/17_mini.png?m=1629391403", "stars": 4217, "aliases": [], "root": false, "id": 17, "parent_node_name": "geek"}, "member": {"id": 574757, "username": "Stash", "url": "https://www.v2ex.com/u/Stash", "website": "", "twitter": "StashNetwork", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "Stash 是一款 iOS 平台基于规则的多协议代理客户端，完全兼容 Clash Premium 配置，支持 RuleSet 规则、按需连接、SSID Policy Group、JavaScript 脚本、MitM、HTTP 改写、覆写配置文件等功能。", "avatar_mini": "https://cdn.v2ex.com/avatar/b3b0/5564/574757_mini.png?m=1646825620", "avatar_normal": "https://cdn.v2ex.com/avatar/b3b0/5564/574757_normal.png?m=1646825620", "avatar_large": "https://cdn.v2ex.com/avatar/b3b0/5564/574757_large.png?m=1646825620", "avatar_xlarge": "https://cdn.v2ex.com/avatar/b3b0/5564/574757_xlarge.png?m=1646825620", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/b3b0/5564/574757_xlarge.png?m=1646825620", "avatar_xxxlarge": "https://cdn.v2ex.com/avatar/b3b0/5564/574757_xlarge.png?m=1646825620", "created": 1646793501, "last_modified": 1646825620}, "last_reply_by": "scemsjyd", "last_touched": 1646861774, "title": "iOS Clash 客户端的新选择，内附兑换码", "url": "https://www.v2ex.com/t/839223", "created": 1646827842, "deleted": 0, "content": "随着智能设备使用规则上网的需求日益增长，我们需要着维护不同平台的软件规则。Stash 能让您在不同的设备使用相同的规则，获得一致的上网体验。\r\n\r\nStash 是一款 iOS 平台基于规则的多协议客户端，完全兼容 **Clash Premium** 配置，支持 RuleSet 规则、按需连接、SSID Policy Group 、JavaScript 脚本、MitM 、HTTP 改写、覆写配置文件等功能。\r\n\r\n#### ▎功能亮点\r\n\r\n**无缝兼容 Clash Premium 配置：**\r\n不需要一行修改，将你的 Windows / Mac 平台的 Clash 配置直接导入 Stash 即可使用。另外配合 Overwrite 功能，可以在保持订阅配置的前提下自由覆写配置内容。\r\n\r\n**Rule Set 规则集：**\r\n专门为海量域名优化的规则集加载器，Stash 在 iOS 15+ 下可以加载百万级 Domain 规则或 500,000+ IP-CIDR 规则的 Rule Set 文件，适用于去广告、地区 IP-CIDR 分流等场景。\r\n\r\n**MitM & Stash Engine：**\r\n支持使用 MitM 和 Stash Engine 捕获连接，捕获后的连接可以支持重写和脚本等高级功能。重写支持修改 HTTP header ，重定向或拦截等多种策略。脚本支持使用 JavaScript 改写 HTTP(S) 请求。\r\n\r\n#### ▎兑换码 🎁\r\nAEEXFM66TFHL\r\nT7RRA4YATYKL\r\nA39LT4JT7WM3\r\nRFXX9EWA6TKN\r\nY4A3R9YEM6X9\r\n\r\n与此同时，我们还会向楼层结尾为 8 的回复评论，PM 我们 Twitter （个人简介） 送出邀请码，如 8/18/28...188 。\r\n回复评论请遵守 V2EX 社区规则，请不要用刷回复的方式 ❤️", "content_rendered": "<p>随着智能设备使用规则上网的需求日益增长，我们需要着维护不同平台的软件规则。Stash 能让您在不同的设备使用相同的规则，获得一致的上网体验。</p>\n<p>Stash 是一款 iOS 平台基于规则的多协议客户端，完全兼容 <strong>Clash Premium</strong> 配置，支持 RuleSet 规则、按需连接、SSID Policy Group 、JavaScript 脚本、MitM 、HTTP 改写、覆写配置文件等功能。</p>\n<h4>▎功能亮点</h4>\n<p><strong>无缝兼容 Clash Premium 配置：</strong>\n不需要一行修改，将你的 Windows / Mac 平台的 Clash 配置直接导入 Stash 即可使用。另外配合 Overwrite 功能，可以在保持订阅配置的前提下自由覆写配置内容。</p>\n<p><strong>Rule Set 规则集：</strong>\n专门为海量域名优化的规则集加载器，Stash 在 iOS 15+ 下可以加载百万级 Domain 规则或 500,000+ IP-CIDR 规则的 Rule Set 文件，适用于去广告、地区 IP-CIDR 分流等场景。</p>\n<p><strong>MitM &amp; Stash Engine：</strong>\n支持使用 MitM 和 Stash Engine 捕获连接，捕获后的连接可以支持重写和脚本等高级功能。重写支持修改 HTTP header ，重定向或拦截等多种策略。脚本支持使用 JavaScript 改写 HTTP(S) 请求。</p>\n<h4>▎兑换码 🎁</h4>\n<p>AEEXFM66TFHL\nT7RRA4YATYKL\nA39LT4JT7WM3\nRFXX9EWA6TKN\nY4A3R9YEM6X9</p>\n<p>与此同时，我们还会向楼层结尾为 8 的回复评论，PM 我们 Twitter （个人简介） 送出邀请码，如 8/18/28...188 。\n回复评论请遵守 V2EX 社区规则，请不要用刷回复的方式 ❤️</p>\n", "last_modified": 1646847354, "replies": 171, "id": 839223}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_large.png?m=1630643913", "name": "apple", "avatar_normal": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_normal.png?m=1630643913", "title": "Apple", "url": "https://www.v2ex.com/go/apple", "topics": 17792, "footer": "", "header": "设计了 <a href=\"/go/watch\">Apple Watch</a>，<a href=\"/go/ipad\">iPad</a>，<a href=\"/go/iphone\">iPhone</a>，<a href=\"/go/imac\">iMac</a> 及 <a href=\"/go/mbp\">MacBook Pro</a> 等电子产品的美国公司。", "title_alternative": "Apple", "avatar_mini": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_mini.png?m=1630643913", "stars": 2088, "aliases": [], "root": false, "id": 184, "parent_node_name": "hardware"}, "member": {"id": 556900, "username": "V9NN", "url": "https://www.v2ex.com/u/V9NN", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/ab5a7987d56e681a68ed920468ec7186?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/ab5a7987d56e681a68ed920468ec7186?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/ab5a7987d56e681a68ed920468ec7186?s=73&d=retro", "created": 1632620580, "last_modified": 1646439710}, "last_reply_by": "gugu33", "last_touched": 1646847749, "title": "今天凌晨的苹果发布会有没有你心动的地方？", "url": "https://www.v2ex.com/t/839002", "created": 1646784878, "deleted": 0, "content": "对 iPhone SE3 一直有期待，这次终于发布了；\r\n新的 MacBook Air 没有出现；\r\n新的 iPad Air 搭载 M1 芯片；\r\n\r\n戴口罩的当下，指纹手机应该是不错的选择，可惜没有 plus 版本。\r\n\r\n大佬们有什么新品挺心动的？", "content_rendered": "对 iPhone SE3 一直有期待，这次终于发布了；<br />新的 MacBook Air 没有出现；<br />新的 iPad Air 搭载 M1 芯片；<br /><br />戴口罩的当下，指纹手机应该是不错的选择，可惜没有 plus 版本。<br /><br />大佬们有什么新品挺心动的？", "last_modified": 1646784878, "replies": 159, "id": 839002}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6e27/13a6/557_large.png?m=1608969785", "name": "life", "avatar_normal": "https://cdn.v2ex.com/navatar/6e27/13a6/557_normal.png?m=1608969785", "title": "生活", "url": "https://www.v2ex.com/go/life", "topics": 2992, "footer": "", "header": "生活中的技术讨论", "title_alternative": "Life", "avatar_mini": "https://cdn.v2ex.com/navatar/6e27/13a6/557_mini.png?m=1608969785", "stars": 797, "aliases": [], "root": false, "id": 557, "parent_node_name": ""}, "member": {"id": 102242, "username": "EIlenZe", "url": "https://www.v2ex.com/u/EIlenZe", "website": "", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/e4db/12fe/102242_mini.png?m=1636896374", "avatar_normal": "https://cdn.v2ex.com/avatar/e4db/12fe/102242_normal.png?m=1636896374", "avatar_large": "https://cdn.v2ex.com/avatar/e4db/12fe/102242_large.png?m=1636896374", "created": 1425403224, "last_modified": 1636896374}, "last_reply_by": "ryd994", "last_touched": 1646781644, "title": "求助！上个月用了 437 度电 现在怎么办？", "url": "https://www.v2ex.com/t/839095", "created": 1646798120, "deleted": 0, "content": "地区是四川成都 \r\n\r\n2022 年 1 月 26 日～ 2 月 26 日，两口之家用了 437 度电（去年同期使用 273 度电），这非常的不正常。 \r\n\r\n\r\n\r\n现在已经打了 95598 了，95598 作为客服平台，只能反馈给所在片区。  \r\n\r\n\r\n\r\n所在片区的负责人说是我们冬天开取暖器造成的，翻看记录日用 20 度左右。 \r\n但是取暖器功率最高也就 1000 瓦，每天要开 10 个小时，30 天才够 300 度。（每天开 10 小时，取暖炉都得开坏了吧，更何况这个东西也不是每天开。） \r\n\r\n\r\n\r\n现在片区负责人说：如果我怀疑表有问题，可以去把表拿到第三方检测，但需要自己出检验费，当然，如果表真的有问题，那么电力部门补齐、赔偿这部分费用。 \r\n\r\n\r\n\r\n但是问题又来了，在上周，电力部门说旧表达到使用年限，为整个小区全部更换了电表，旧电表已经被收回了。现在把旧表翻出来，还能是当时的表吗。\r\n\r\n\r\n对了，顺便说一句，电器关完，电表没走了，已经排除偷电的可能性。  \r\n\r\n\r\n现在就想请教 V 友们  \r\n1 、这种表出问题的可能性大吗？\r\n\r\n2 、现在如果真的让电力部门从仓库把旧表找出来，让我拿去检验，胜算的几率大吗？ \r\n\r\n3 、如果不是电表的问题，还有什么可能性，会使用那么多的电？ \r\n\r\n4 、现在应该怎么办呢？", "content_rendered": "<p>地区是四川成都 </p>\n<p>2022 年 1 月 26 日～ 2 月 26 日，两口之家用了 437 度电（去年同期使用 273 度电），这非常的不正常。 </p>\n<p>现在已经打了 95598 了，95598 作为客服平台，只能反馈给所在片区。  </p>\n<p>所在片区的负责人说是我们冬天开取暖器造成的，翻看记录日用 20 度左右。\n但是取暖器功率最高也就 1000 瓦，每天要开 10 个小时，30 天才够 300 度。（每天开 10 小时，取暖炉都得开坏了吧，更何况这个东西也不是每天开。） </p>\n<p>现在片区负责人说：如果我怀疑表有问题，可以去把表拿到第三方检测，但需要自己出检验费，当然，如果表真的有问题，那么电力部门补齐、赔偿这部分费用。 </p>\n<p>但是问题又来了，在上周，电力部门说旧表达到使用年限，为整个小区全部更换了电表，旧电表已经被收回了。现在把旧表翻出来，还能是当时的表吗。</p>\n<p>对了，顺便说一句，电器关完，电表没走了，已经排除偷电的可能性。  </p>\n<p>现在就想请教 V 友们<br/>\n1 、这种表出问题的可能性大吗？</p>\n<p>2 、现在如果真的让电力部门从仓库把旧表找出来，让我拿去检验，胜算的几率大吗？ </p>\n<p>3 、如果不是电表的问题，还有什么可能性，会使用那么多的电？ </p>\n<p>4 、现在应该怎么办呢？</p>\n", "last_modified": 1646798120, "replies": 110, "id": 839095}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1629391393", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1629391393", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 182298, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1629391393", "stars": 3432, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 464372, "username": "yurong333333", "url": "https://www.v2ex.com/u/yurong333333", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/4012fcb62c1afa3132691c50cdf68980?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/4012fcb62c1afa3132691c50cdf68980?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/4012fcb62c1afa3132691c50cdf68980?s=73&d=retro", "created": 1578665496, "last_modified": 1578665496}, "last_reply_by": "so2back", "last_touched": 1646782716, "title": "B 站登录原理", "url": "https://www.v2ex.com/t/839140", "created": 1646808175, "deleted": 0, "content": "没登录之前，打开两个 b 站的网页 A 和 B ，在 A 网页登录，然后刷新一下 B 网页，发现 B 网页也显示登录了，这是什么原理呢？", "content_rendered": "<p>没登录之前，打开两个 b 站的网页 A 和 B ，在 A 网页登录，然后刷新一下 B 网页，发现 B 网页也显示登录了，这是什么原理呢？</p>\n", "last_modified": 1646808175, "replies": 104, "id": 839140}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_large.png?m=1630643913", "name": "apple", "avatar_normal": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_normal.png?m=1630643913", "title": "Apple", "url": "https://www.v2ex.com/go/apple", "topics": 17792, "footer": "", "header": "设计了 <a href=\"/go/watch\">Apple Watch</a>，<a href=\"/go/ipad\">iPad</a>，<a href=\"/go/iphone\">iPhone</a>，<a href=\"/go/imac\">iMac</a> 及 <a href=\"/go/mbp\">MacBook Pro</a> 等电子产品的美国公司。", "title_alternative": "Apple", "avatar_mini": "https://cdn.v2ex.com/navatar/6cdd/60ea/184_mini.png?m=1630643913", "stars": 2088, "aliases": [], "root": false, "id": 184, "parent_node_name": "hardware"}, "member": {"id": 36810, "username": "czhu", "url": "https://www.v2ex.com/u/czhu", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/c4bb/c69c/36810_mini.png?m=1646790569", "avatar_normal": "https://cdn.v2ex.com/avatar/c4bb/c69c/36810_normal.png?m=1646790569", "avatar_large": "https://cdn.v2ex.com/avatar/c4bb/c69c/36810_large.png?m=1646790569", "created": 1364593184, "last_modified": 1646790569}, "last_reply_by": "Henrybsbhp", "last_touched": 1646842624, "title": "苹果新显示器 Apple Studio Display", "url": "https://www.v2ex.com/t/838999", "created": 1646781576, "deleted": 0, "content": "![Apple Studio Display]( https://www.apple.com/v/studio-display/a/images/specs/hero__fjwz2k1uofue_large_2x.jpg)\r\n\r\n\r\n刚发布的, 27 寸 5K 显示器，自带摄像头和音响，还有一颗 A13 芯片。没有 ProMotion ，也没有 microLED 没有 HDR 。\r\n\r\n基本就是 LG Ultrafine 5K 的金属换壳版本。亮度从 500 到了 600nits 。同样的 P3 ，原生支持 TrueTone 。\r\n\r\n售价 1599 美金，比 1299 美金的拉胯 LG 5K 还算良心了吧。\r\n\r\n在等 27 寸 5K 显示器的下单了吗？", "content_rendered": "<p><img alt=\"Apple Studio Display\" class=\"embedded_image\" loading=\"lazy\" referrerpolicy=\"no-referrer\" rel=\"noreferrer\" src=\"https://www.apple.com/v/studio-display/a/images/specs/hero__fjwz2k1uofue_large_2x.jpg\"/></p>\n<p>刚发布的, 27 寸 5K 显示器，自带摄像头和音响，还有一颗 A13 芯片。没有 ProMotion ，也没有 microLED 没有 HDR 。</p>\n<p>基本就是 LG Ultrafine 5K 的金属换壳版本。亮度从 500 到了 600nits 。同样的 P3 ，原生支持 TrueTone 。</p>\n<p>售价 1599 美金，比 1299 美金的拉胯 LG 5K 还算良心了吧。</p>\n<p>在等 27 寸 5K 显示器的下单了吗？</p>\n", "last_modified": 1646781576, "replies": 71, "id": 838999}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1629391393", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1629391393", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 182298, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1629391393", "stars": 3432, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 513536, "username": "shanghai1943", "url": "https://www.v2ex.com/u/shanghai1943", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/9a762f28db68d2a4984152ab647901ea?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/9a762f28db68d2a4984152ab647901ea?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/9a762f28db68d2a4984152ab647901ea?s=73&d=retro", "created": 1603161941, "last_modified": 1646384163}, "last_reply_by": "TT911", "last_touched": 1646833873, "title": "求推荐电饭锅", "url": "https://www.v2ex.com/t/839023", "created": 1646791020, "deleted": 0, "content": "家里电饭锅用了两年多了，锅底有很多划痕，现在煮饭锅底老是会粘住，所以想换一个，预算大概在四五百。\r\n\r\n这几天看了一下某乎，说是铁釜的锅会比铝合金的好，电磁加热的比锅底加热的好，就是比较贵，低端的电磁加热似乎不推荐。目前看了几款美的和苏泊尔的，价格三百多的，似乎也不错。\r\n\r\n想问下各位老哥有什么推荐的么。。谢谢。", "content_rendered": "<p>家里电饭锅用了两年多了，锅底有很多划痕，现在煮饭锅底老是会粘住，所以想换一个，预算大概在四五百。</p>\n<p>这几天看了一下某乎，说是铁釜的锅会比铝合金的好，电磁加热的比锅底加热的好，就是比较贵，低端的电磁加热似乎不推荐。目前看了几款美的和苏泊尔的，价格三百多的，似乎也不错。</p>\n<p>想问下各位老哥有什么推荐的么。。谢谢。</p>\n", "last_modified": 1646791020, "replies": 64, "id": 839023}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/03af/dbd6/63_large.png?m=1644490200", "name": "java", "avatar_normal": "https://cdn.v2ex.com/navatar/03af/dbd6/63_normal.png?m=1644490200", "title": "Java", "url": "https://www.v2ex.com/go/java", "topics": 4832, "footer": "", "header": "Sun 公司发明，被广泛使用的一门编程语言。", "title_alternative": "Java", "avatar_mini": "https://cdn.v2ex.com/navatar/03af/dbd6/63_mini.png?m=1644490200", "stars": 4824, "aliases": [], "root": false, "id": 63, "parent_node_name": "programming"}, "member": {"id": 566515, "username": "frank1256", "url": "https://www.v2ex.com/u/frank1256", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/avatar/66bc/2161/566515_mini.png?m=1641453104", "avatar_normal": "https://cdn.v2ex.com/avatar/66bc/2161/566515_normal.png?m=1641453104", "avatar_large": "https://cdn.v2ex.com/avatar/66bc/2161/566515_large.png?m=1641453104", "avatar_xlarge": "https://cdn.v2ex.com/avatar/66bc/2161/566515_xlarge.png?m=1641453104", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/66bc/2161/566515_xlarge.png?m=1641453104", "avatar_xxxlarge": "https://cdn.v2ex.com/avatar/66bc/2161/566515_xlarge.png?m=1641453104", "created": 1640222925, "last_modified": 1641453104}, "last_reply_by": "Leviathann", "last_touched": 1646837394, "title": "高并发下订单状态更新", "url": "https://www.v2ex.com/t/839046", "created": 1646793423, "deleted": 0, "content": "# 场景\r\n订单存在 flag 字段，0 未支付，1 支付中，2 支付完成。\r\n发起支付场景中，会先查询订单状态是否为 0 ，然后更新为 1 ，并且调用第三方支付系统获取 h5 的支付地址(耗时操作)。用户在 h5 上完成支付后，第三方支付系统会异步通知到后台服务。进行订单更新动作，并保存流水号。\r\n# 具体代码\r\n## 支付发起\r\n支付发起之前，会查库，判断 flag 是否为 0 ，可以的才会继续\r\n## 异步通知\r\n接收到第三方系统的异步通知后，会查库，判断 flag 是否为 1 ，可以的话才会更新订单。\r\n\r\n# 问题\r\n高并发下，第一个线程查库，查到 flag 是 0 ，在数据库没更新完成的情况下，第二个线程也来查库，查到是 flag 也是 0.同时发起了支付。如何防止这种场景呢？假设在单节点情况下，直接加 synchronized ，可以避免。但是这样的话，是对所有的线程都进行了阻塞，实际情况下，我们只是要对相同订单进行阻塞。不同订单不进行阻塞的。\r\n\r\n在异步回调的情况也是一样，也是要先查订单状态 flag 为 1 的话，才会进行下一步动作，如果并发情况下出现了 2 个线程都查到是 flag 为 1 怎么处理？\r\n\r\n# 目前思路\r\n加锁，但是锁了所有的线程，订单 1 多个线程同时发起支付的话，需要加锁阻塞，只能有一个发起成功，但是不能影响订单 2 的发起支付。实际上只是为了锁同一笔订单。\r\n\r\n用乐观锁，然后数据库 update 的时候，where  flag=某个条件。一定会有一个线程更新失败，更新成功的才会进行后续操作。这样的话，会对数据库有影响吗？\r\n\r\n想请问大佬们，这种先查库得到条件，再根据条件做后续动作的场景，在高并发下应该如何处理呢？", "content_rendered": "<h1>场景</h1>\n<p>订单存在 flag 字段，0 未支付，1 支付中，2 支付完成。\n发起支付场景中，会先查询订单状态是否为 0 ，然后更新为 1 ，并且调用第三方支付系统获取 h5 的支付地址(耗时操作)。用户在 h5 上完成支付后，第三方支付系统会异步通知到后台服务。进行订单更新动作，并保存流水号。</p>\n<h1>具体代码</h1>\n<h2>支付发起</h2>\n<p>支付发起之前，会查库，判断 flag 是否为 0 ，可以的才会继续</p>\n<h2>异步通知</h2>\n<p>接收到第三方系统的异步通知后，会查库，判断 flag 是否为 1 ，可以的话才会更新订单。</p>\n<h1>问题</h1>\n<p>高并发下，第一个线程查库，查到 flag 是 0 ，在数据库没更新完成的情况下，第二个线程也来查库，查到是 flag 也是 0.同时发起了支付。如何防止这种场景呢？假设在单节点情况下，直接加 synchronized ，可以避免。但是这样的话，是对所有的线程都进行了阻塞，实际情况下，我们只是要对相同订单进行阻塞。不同订单不进行阻塞的。</p>\n<p>在异步回调的情况也是一样，也是要先查订单状态 flag 为 1 的话，才会进行下一步动作，如果并发情况下出现了 2 个线程都查到是 flag 为 1 怎么处理？</p>\n<h1>目前思路</h1>\n<p>加锁，但是锁了所有的线程，订单 1 多个线程同时发起支付的话，需要加锁阻塞，只能有一个发起成功，但是不能影响订单 2 的发起支付。实际上只是为了锁同一笔订单。</p>\n<p>用乐观锁，然后数据库 update 的时候，where  flag=某个条件。一定会有一个线程更新失败，更新成功的才会进行后续操作。这样的话，会对数据库有影响吗？</p>\n<p>想请问大佬们，这种先查库得到条件，再根据条件做后续动作的场景，在高并发下应该如何处理呢？</p>\n", "last_modified": 1646793795, "replies": 64, "id": 839046}]