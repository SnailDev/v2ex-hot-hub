[{"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 227093, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4290, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 457684, "username": "asanelder", "url": "https://www.v2ex.com/u/asanelder", "website": "", "twitter": "", "psn": "", "github": "", "btc": "", "location": "", "tagline": "", "bio": "保持理智\r\n相信现在", "avatar_mini": "https://cdn.v2ex.com/avatar/2d42/6424/457684_mini.png?m=1669650399", "avatar_normal": "https://cdn.v2ex.com/avatar/2d42/6424/457684_normal.png?m=1669650399", "avatar_large": "https://cdn.v2ex.com/avatar/2d42/6424/457684_large.png?m=1669650399", "created": 1575563857, "last_modified": 1669650399}, "last_reply_by": "zzzzzzggggggg", "last_touched": 1735943787, "title": "有没有觉得“延迟满足”就是扯淡！", "url": "https://www.v2ex.com/t/1102278", "created": 1735881683, "deleted": 0, "content": "当年在学校的时候，有机会恋爱，但想着应该好好学习，找个好工作，挣大钱，延迟满足找女朋友的欲望，这样毕业后能找到更好的女人。\r\n\r\n结果呢。。。不说了。。。至今单身，走在路上狗都不多看你一眼。\r\n至于那些上学就是“乱搞”男女关系，享受即时满足的，人家孩子都有了，活的老特么幸福了。\r\n\r\n特么的，再也不信延迟满足了", "content_rendered": "当年在学校的时候，有机会恋爱，但想着应该好好学习，找个好工作，挣大钱，延迟满足找女朋友的欲望，这样毕业后能找到更好的女人。<br /><br />结果呢。。。不说了。。。至今单身，走在路上狗都不多看你一眼。<br />至于那些上学就是“乱搞”男女关系，享受即时满足的，人家孩子都有了，活的老特么幸福了。<br /><br />特么的，再也不信延迟满足了", "last_modified": 1735881683, "replies": 89, "id": 1102278}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/3b3d/baf6/865_large.png?m=1439180025", "name": "however", "avatar_normal": "https://cdn.v2ex.com/navatar/3b3d/baf6/865_normal.png?m=1439180025", "title": "然而并没有", "url": "https://www.v2ex.com/go/however", "topics": 203, "footer": "", "header": "不要怪我们没有警告过你 / 我们都有不顺利的时候 / Something happened / 这真是让人尴尬 / 请坐和放宽 / 滚回以前的版本 / 这就是你的人生 / 是的，你的人生", "title_alternative": "However", "avatar_mini": "https://cdn.v2ex.com/navatar/3b3d/baf6/865_mini.png?m=1439180025", "stars": 429, "aliases": [], "root": false, "id": 865, "parent_node_name": ""}, "member": {"id": 684488, "username": "tool2dx", "url": "https://www.v2ex.com/u/tool2dx", "website": "tool2d.com", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/c810/399e/684488_mini.png?m=1717643695", "avatar_normal": "https://cdn.v2ex.com/avatar/c810/399e/684488_normal.png?m=1717643695", "avatar_large": "https://cdn.v2ex.com/avatar/c810/399e/684488_large.png?m=1717643695", "avatar_xlarge": "https://cdn.v2ex.com/avatar/c810/399e/684488_xlarge.png?m=1717643695", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/c810/399e/684488_xlarge.png?m=1717643695", "created": 1712713907, "last_modified": 1717643695}, "last_reply_by": "mcfog", "last_touched": 1735056899, "title": "openssh 协议貌似已经一统天下了。", "url": "https://www.v2ex.com/t/1102348", "created": 1735893938, "deleted": 0, "content": "以前是 linux 内置，后来是 macos 内置，现在是 windows 内置。\r\n\r\nsmb 已经完成了历史使命，可以安心退出舞台了。\r\n\r\nps: 什么时候操作系统也统一一下就好了，现在写一个界面程序，要三套代码，真是晕死。", "content_rendered": "<p>以前是 linux 内置，后来是 macos 内置，现在是 windows 内置。</p>\n<p>smb 已经完成了历史使命，可以安心退出舞台了。</p>\n<p>ps: 什么时候操作系统也统一一下就好了，现在写一个界面程序，要三套代码，真是晕死。</p>\n", "last_modified": 1735902963, "replies": 66, "id": 1102348}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 227093, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4290, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 491770, "username": "TwentyNine", "url": "https://www.v2ex.com/u/TwentyNine", "website": "", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/43f5/4d89/491770_mini.png?m=1592271377", "avatar_normal": "https://cdn.v2ex.com/avatar/43f5/4d89/491770_normal.png?m=1592271377", "avatar_large": "https://cdn.v2ex.com/avatar/43f5/4d89/491770_large.png?m=1592271377", "created": 1590547576, "last_modified": 1592271377}, "last_reply_by": "LZYMichael", "last_touched": 1735938540, "title": "年轻人是先买房还是先买车", "url": "https://www.v2ex.com/t/1102343", "created": 1735893283, "deleted": 0, "content": "目前在外上班，不在老家城市，浑浑噩噩好久。新的一年想做出点改变，打算买个房子付个首付慢慢开始还房贷，但是目前心里不知道往哪买，也不太清楚房价走势，或者买个车付个首付还车贷也行，总得做点什么。", "content_rendered": "<p>目前在外上班，不在老家城市，浑浑噩噩好久。新的一年想做出点改变，打算买个房子付个首付慢慢开始还房贷，但是目前心里不知道往哪买，也不太清楚房价走势，或者买个车付个首付还车贷也行，总得做点什么。</p>\n", "last_modified": 1735893283, "replies": 52, "id": 1102343}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/4ea0/6fbc/770_large.png?m=1695370146", "name": "career", "avatar_normal": "https://cdn.v2ex.com/navatar/4ea0/6fbc/770_normal.png?m=1695370146", "title": "职场话题", "url": "https://www.v2ex.com/go/career", "topics": 18932, "footer": "", "header": "这里，我们聊聊那些工作中遇到的开心和不开心的事。", "title_alternative": "Career", "avatar_mini": "https://cdn.v2ex.com/navatar/4ea0/6fbc/770_mini.png?m=1695370146", "stars": 3331, "aliases": [], "root": false, "id": 770, "parent_node_name": "work"}, "member": {"id": 379936, "username": "iseki", "url": "https://www.v2ex.com/u/iseki", "website": "", "twitter": "iseki_zero", "psn": "", "github": "iseki0", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/721d70c80ade836659693895ef66bbff?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/721d70c80ade836659693895ef66bbff?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/721d70c80ade836659693895ef66bbff?s=73&d=retro", "created": 1548341181, "last_modified": 1707451906}, "last_reply_by": "summerwar", "last_touched": 1735965457, "title": "为何见许多人抱怨上了多年学，最后只能去做个收入不高的工作，而不是去抱怨，为何存在这样收入低的工作呢？", "url": "https://www.v2ex.com/t/1102393", "created": 1735909156, "deleted": 0, "content": "奇怪之处似乎在于，这些人似乎觉得，自己在有机会接受了多年教育后，就理应得到显著高于他人的收入。🤔🤔🤔", "content_rendered": "奇怪之处似乎在于，这些人似乎觉得，自己在有机会接受了多年教育后，就理应得到显著高于他人的收入。🤔🤔🤔", "last_modified": 1735909551, "replies": 37, "id": 1102393}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_large.png?m=1733731195", "name": "programmer", "avatar_normal": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_normal.png?m=1733731195", "title": "程序员", "url": "https://www.v2ex.com/go/programmer", "topics": 65283, "footer": "", "header": "While code monkeys are not eating bananas, they're coding.", "title_alternative": "Programmer", "avatar_mini": "https://cdn.v2ex.com/navatar/94f6/d7e0/300_mini.png?m=1733731195", "stars": 9181, "aliases": [], "root": false, "id": 300, "parent_node_name": "computer"}, "member": {"id": 639476, "username": "LZYMichael", "url": "https://www.v2ex.com/u/LZYMichael", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/91972dc05b38023e6268ae843cdf45f4?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/91972dc05b38023e6268ae843cdf45f4?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/91972dc05b38023e6268ae843cdf45f4?s=73&d=retro", "created": 1689910157, "last_modified": 1689910157}, "last_reply_by": "LZYMichael", "last_touched": 1735928417, "title": "我们将使用母语编程", "url": "https://www.v2ex.com/t/1102281", "created": 1735882435, "deleted": 0, "content": "自从 2022 年底**ChatGPT**横空出世以来，ta 就注定会改变我们的编程方式。\r\n\r\n我对**大语言模型**保持了相当的好奇，也一直在积极拥抱这一新鲜事物。标题**我们将使用母语编程**是我在使用两年多年后的今天最新得到的结论，下面举一个今天的使用案例来说明为什么我在今天得出了这一看似激进的结论。\r\n\r\n\r\n**大语言模型**：Claude 3.5 Sonnet\r\n\r\n**需求**：基于 Cairo 库为我的 TransportSTN 类绘图\r\n\r\n**语言**：C++\r\n\r\n\r\n**第一轮**\r\n\r\n提示词：“我想利用 Cairo 库，基于我自己的 TransportSTN 类来绘制图；我的图形类如下：'给出 TransportSTN 相关类'；对 TransportSTN 成员变量的一些说明；提出绘图要求（点、线样式）”。\r\n\r\n生成代码后我运行的结果：\r\n\r\n[Imgur]( https://imgur.com/DNzpCpD)\r\n\r\n**第二轮**\r\n\r\n提示词：“可以绘制了，但结果并非期待的那样。\r\n我希望同一个 t 的点在一列，同一个 fa 的点簇（每簇有 3 个，即 M=3 ，每簇呈现出三角形，为了后面弧避免重叠）在一行”\r\n\r\n生成代码后我运行的结果：\r\n\r\n[Imgur]( https://imgur.com/nJly1n7)\r\n\r\n**第三轮**\r\n\r\n提示词：“\r\n现在已经很棒了，但有以下需要改进的地方：\r\n1. 每一簇点（ 3 个）现在呈现出了一个完美的等边三角形；\r\n2. 同一个 Fa 、不同 t 的点簇完全在一行上；\r\n3. 1 和 2 两点会导致绘制弧的时候会有很大概率重叠，我之前的解决方案是：\r\n   - 点簇程钝角三角形，钝角顶点在右侧，类似下面这样：\r\n   ```\r\n    .\r\n       .\r\n\r\n    .\r\n   ```   \r\n   - 不同 t 交错排列，类似下面这样：\r\n   ```\r\n   t=2            t=4            t=6    // 时间层\r\n    •    t=3      •      t=5     •     // fa=0 的航空点\r\n   - •     •     • •      •     • •    // fa=0 的铁路和公路点\r\n          • •            • •\r\n    •             •              •     // fa=1 的航空点\r\n   - •     •     • •      •     • •    // fa=1 的铁路和公路点\r\n          • •            • •\r\n   ```\r\n\r\n”\r\n\r\n生成代码后我运行的结果：\r\n\r\n[Imgur]( https://imgur.com/FLst2EI)\r\n\r\n\r\n\r\n可以看到，一个要求使用 C++、相对复杂的需求，仅仅经过了三轮对话，就几乎实现了我们想要的结果。\r\n\r\n这期间我唯一使用到的“语言”就是中文。现在是 2025 年，大语言模型仅仅出来不到两年半，所以我认为最迟到 2030 年，所有人都将是程序员，我们将使用母语编程。", "content_rendered": "<p>自从 2022 年底<strong>ChatGPT</strong>横空出世以来，ta 就注定会改变我们的编程方式。</p>\n<p>我对<strong>大语言模型</strong>保持了相当的好奇，也一直在积极拥抱这一新鲜事物。标题<strong>我们将使用母语编程</strong>是我在使用两年多年后的今天最新得到的结论，下面举一个今天的使用案例来说明为什么我在今天得出了这一看似激进的结论。</p>\n<p><strong>大语言模型</strong>：Claude 3.5 Sonnet</p>\n<p><strong>需求</strong>：基于 Cairo 库为我的 TransportSTN 类绘图</p>\n<p><strong>语言</strong>：C++</p>\n<p><strong>第一轮</strong></p>\n<p>提示词：“我想利用 Cairo 库，基于我自己的 TransportSTN 类来绘制图；我的图形类如下：'给出 TransportSTN 相关类'；对 TransportSTN 成员变量的一些说明；提出绘图要求（点、线样式）”。</p>\n<p>生成代码后我运行的结果：</p>\n<p><a href=\"https://imgur.com/DNzpCpD\" rel=\"nofollow\">Imgur</a></p>\n<p><strong>第二轮</strong></p>\n<p>提示词：“可以绘制了，但结果并非期待的那样。\n我希望同一个 t 的点在一列，同一个 fa 的点簇（每簇有 3 个，即 M=3 ，每簇呈现出三角形，为了后面弧避免重叠）在一行”</p>\n<p>生成代码后我运行的结果：</p>\n<p><a href=\"https://imgur.com/nJly1n7\" rel=\"nofollow\">Imgur</a></p>\n<p><strong>第三轮</strong></p>\n<p>提示词：“\n现在已经很棒了，但有以下需要改进的地方：</p>\n<ol>\n<li>每一簇点（ 3 个）现在呈现出了一个完美的等边三角形；</li>\n<li>同一个 Fa 、不同 t 的点簇完全在一行上；</li>\n<li>\n1 和 2 两点会导致绘制弧的时候会有很大概率重叠，我之前的解决方案是：<ul>\n<li>点簇程钝角三角形，钝角顶点在右侧，类似下面这样：</li>\n</ul>\n<pre><code> .\n    .\n\n .\n</code></pre>\n<ul>\n<li>不同 t 交错排列，类似下面这样：</li>\n</ul>\n<pre><code>t=2            t=4            t=6    // 时间层\n •    t=3      •      t=5     •     // fa=0 的航空点\n- •     •     • •      •     • •    // fa=0 的铁路和公路点\n       • •            • •\n •             •              •     // fa=1 的航空点\n- •     •     • •      •     • •    // fa=1 的铁路和公路点\n       • •            • •\n</code></pre>\n</li>\n</ol>\n<p>”</p>\n<p>生成代码后我运行的结果：</p>\n<p><a href=\"https://imgur.com/FLst2EI\" rel=\"nofollow\">Imgur</a></p>\n<p>可以看到，一个要求使用 C++、相对复杂的需求，仅仅经过了三轮对话，就几乎实现了我们想要的结果。</p>\n<p>这期间我唯一使用到的“语言”就是中文。现在是 2025 年，大语言模型仅仅出来不到两年半，所以我认为最迟到 2030 年，所有人都将是程序员，我们将使用母语编程。</p>\n", "last_modified": 1735882656, "replies": 37, "id": 1102281}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/6680/8e32/414_large.png?m=1436505183", "name": "os", "avatar_normal": "https://cdn.v2ex.com/navatar/6680/8e32/414_normal.png?m=1436505183", "title": "操作系统", "url": "https://www.v2ex.com/go/os", "topics": 128, "footer": "", "header": "关于操作系统基本概念的讨论，及各种不为人知的小众系统", "title_alternative": "Operating System", "avatar_mini": "https://cdn.v2ex.com/navatar/6680/8e32/414_mini.png?m=1436505183", "stars": 315, "aliases": [], "root": false, "id": 414, "parent_node_name": "computer"}, "member": {"id": 96532, "username": "shmilypeter", "url": "https://www.v2ex.com/u/shmilypeter", "website": "", "twitter": "", "psn": "", "github": "chenqifeng92", "btc": "", "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/gravatar/618607307eb0a82e539c89262378e771?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/618607307eb0a82e539c89262378e771?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/618607307eb0a82e539c89262378e771?s=73&d=retro", "created": 1423453531, "last_modified": 1708176754}, "last_reply_by": "summerwar", "last_touched": 1735965677, "title": "可以利用 wsl 绕过公司电脑监控吗？", "url": "https://www.v2ex.com/t/1102438", "created": 1735953205, "deleted": 0, "content": "公司配发的电脑经过标装，安装软件只能通过指定的应用商店，否则根本没权限执行安装程序。\r\n同样即便是公司笔记本带回家，本地的上网行为管理软件也不允许访问大部分外部网站，会直接拦截掉，同时即便是允许的外部网站上网行为管理软件也做了证书替换。\r\n\r\n我想通过 wsl 装一个 ubuntu 桌面版，通过远程桌面连接直接用 ubuntu 桌面版，用桥接给虚拟机联网这样就绕过了上网行为管理，然后自然在 wsl 虚拟机里我想干啥就干啥了。\r\n\r\n请问这样还有被发现的可能吗？", "content_rendered": "<p>公司配发的电脑经过标装，安装软件只能通过指定的应用商店，否则根本没权限执行安装程序。\n同样即便是公司笔记本带回家，本地的上网行为管理软件也不允许访问大部分外部网站，会直接拦截掉，同时即便是允许的外部网站上网行为管理软件也做了证书替换。</p>\n<p>我想通过 wsl 装一个 ubuntu 桌面版，通过远程桌面连接直接用 ubuntu 桌面版，用桥接给虚拟机联网这样就绕过了上网行为管理，然后自然在 wsl 虚拟机里我想干啥就干啥了。</p>\n<p>请问这样还有被发现的可能吗？</p>\n", "last_modified": 1735953205, "replies": 34, "id": 1102438}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 227093, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4290, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 366740, "username": "6379616e", "url": "https://www.v2ex.com/u/6379616e", "website": "chat.0x403.com", "twitter": null, "psn": null, "github": null, "btc": null, "location": "", "tagline": "", "bio": "", "avatar_mini": "https://cdn.v2ex.com/avatar/bd79/52af/366740_mini.png?m=1698892090", "avatar_normal": "https://cdn.v2ex.com/avatar/bd79/52af/366740_normal.png?m=1698892090", "avatar_large": "https://cdn.v2ex.com/avatar/bd79/52af/366740_large.png?m=1698892090", "avatar_xlarge": "https://cdn.v2ex.com/avatar/bd79/52af/366740_xlarge.png?m=1698892090", "avatar_xxlarge": "https://cdn.v2ex.com/avatar/bd79/52af/366740_xlarge.png?m=1698892090", "created": 1543496639, "last_modified": 1698892090}, "last_reply_by": "Damn", "last_touched": 1735931273, "title": "雷军：科技不再是高高在上，那么红米 14C 值得入吗？", "url": "https://www.v2ex.com/t/1102309", "created": 1735886503, "deleted": 0, "content": "", "content_rendered": "", "last_modified": 1735886503, "replies": 30, "id": 1102309}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_large.png?m=1650095340", "name": "qna", "avatar_normal": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_normal.png?m=1650095340", "title": "问与答", "url": "https://www.v2ex.com/go/qna", "topics": 227093, "footer": "", "header": "一个更好的世界需要你持续地提出好问题。", "title_alternative": "Questions and Answers", "avatar_mini": "https://cdn.v2ex.com/navatar/c20a/d4d7/12_mini.png?m=1650095340", "stars": 4290, "aliases": [], "root": false, "id": 12, "parent_node_name": "v2ex"}, "member": {"id": 657343, "username": "fffq", "url": "https://www.v2ex.com/u/fffq", "website": null, "twitter": null, "psn": null, "github": null, "btc": null, "location": null, "tagline": null, "bio": null, "avatar_mini": "https://cdn.v2ex.com/gravatar/c532ce725b10d767f990b74d8780eb9a?s=24&d=retro", "avatar_normal": "https://cdn.v2ex.com/gravatar/c532ce725b10d767f990b74d8780eb9a?s=48&d=retro", "avatar_large": "https://cdn.v2ex.com/gravatar/c532ce725b10d767f990b74d8780eb9a?s=73&d=retro", "created": 1698818861, "last_modified": 1698818861}, "last_reply_by": "Ahiok", "last_touched": 1735966543, "title": "v2er 们，百元以内蓝牙耳机哪家强", "url": "https://www.v2ex.com/t/1102436", "created": 1735952527, "deleted": 0, "content": "", "content_rendered": "", "last_modified": 1735952527, "replies": 29, "id": 1102436}, {"node": {"avatar_large": "https://cdn.v2ex.com/navatar/b0b1/83c2/837_large.png?m=1650095159", "name": "react", "avatar_normal": "https://cdn.v2ex.com/navatar/b0b1/83c2/837_normal.png?m=1650095159", "title": "React", "url": "https://www.v2ex.com/go/react", "topics": 683, "footer": "", "header": "一个用于构建用户界面的 JavaScript 库", "title_alternative": "React", "avatar_mini": "https://cdn.v2ex.com/navatar/b0b1/83c2/837_mini.png?m=1650095159", "stars": 1084, "aliases": [], "root": false, "id": 837, "parent_node_name": "js"}, "member": {"id": 635754, "username": "ooo4", "url": "https://www.v2ex.com/u/ooo4", "website": "https://blog-linzhe141.vercel.app/", "twitter": null, "psn": null, "github": null, "btc": null, "location": "chengdu", "tagline": "形而上学，不行上班", "bio": "菜鸟前端", "avatar_mini": "https://cdn.v2ex.com/avatar/d52d/6326/635754_mini.png?m=1735637004", "avatar_normal": "https://cdn.v2ex.com/avatar/d52d/6326/635754_normal.png?m=1735637004", "avatar_large": "https://cdn.v2ex.com/avatar/d52d/6326/635754_large.png?m=1735637004", "created": 1687684594, "last_modified": 1735637004}, "last_reply_by": "ljpCN", "last_touched": 1735912142, "title": "react 新手关于 react useEffect 的困惑，为什么 useEffect 里面的 cleanup 函数里面的 props 是旧的，如何从源码解释？", "url": "https://www.v2ex.com/t/1102355", "created": 1735895342, "deleted": 0, "content": "`版本： react@18.3.1`\r\n\r\n我看源码就是先 UnmountEffects 后 MountEffects,里面也只是递归遍历而已，为什么 cleanup 里面的 props 是上一次的了？\r\n```js\r\ncommitPassiveUnmountEffects(root.current);\r\ncommitPassiveMountEffects(root, root.current, lanes, transitions);\r\n```\r\n\r\n\r\n```jsx\r\n// 复现的 demo\r\nfunction App() {\r\n  const [num, setNum] = useState(100)\r\n  window.__setNum = setNum\r\n  return <Comp num={num}></Comp>\r\n}\r\n\r\nfunction Comp(props) {\r\n  debugger\r\n  useEffect(() => {\r\n    debugger\r\n    props // {num:1000}\r\n    return () => {\r\n      debugger\r\n      // 为什么这里是旧的 props? {num:100}\r\n      props\r\n    }\r\n  }, [props.num])\r\n  return (\r\n    <p>\r\n      <span>{props.num}</span>\r\n    </p>\r\n  )\r\n}\r\n\r\nsetTimeout(() => {\r\n  __setNum(1000)\r\n}, 1000)\r\n```", "content_rendered": "<p>版本： react@18.3.1</p>\n<p>我看源码就是先 UnmountEffects 后 MountEffects,里面也只是递归遍历而已，为什么 cleanup 里面的 props 是上一次的了？</p>\n<pre><code class=\"language-js\">commitPassiveUnmountEffects(root.current);\ncommitPassiveMountEffects(root, root.current, lanes, transitions);\n</code></pre>\n<pre><code class=\"language-jsx\">// 复现的 demo\nfunction App() {\n  const [num, setNum] = useState(100)\n  window.__setNum = setNum\n  return &lt;Comp num={num}&gt;&lt;/Comp&gt;\n}\n\nfunction Comp(props) {\n  debugger\n  useEffect(() =&gt; {\n    debugger\n    props // {num:1000}\n    return () =&gt; {\n      debugger\n      // 为什么这里是旧的 props? {num:100}\n      props\n    }\n  }, [props.num])\n  return (\n    &lt;p&gt;\n      &lt;span&gt;{props.num}&lt;/span&gt;\n    &lt;/p&gt;\n  )\n}\n\nsetTimeout(() =&gt; {\n  __setNum(1000)\n}, 1000)\n</code></pre>\n", "last_modified": 1735895342, "replies": 27, "id": 1102355}]